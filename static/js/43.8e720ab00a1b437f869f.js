webpackJsonp([43],{Hgp3:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("xF2Z"),n=i("0XQL"),s=i("9fS5"),o=i("F/2K"),r=i("a/7L"),l=i("YlZe"),d=i("csCE"),c=i("9Wgl"),u={name:"modal-detail-master-profile",components:{},props:["masterProfileId"],data:function(){return{users:[],loading:!1}},created:function(){},watch:{},methods:{hideModal:function(){this.$refs.myModalRef.hide()},getUsersByMasterProfileId:function(){var t=this,e={id:this.masterProfileId};a.a.getUsersByMasterProfileId(e).then(function(e){e.data.success&&(t.users=e.data.data,t.loading=!1)}).catch(function(t){console.log(t)})},getUserStatusName:function(t){return c.a.getStatusName(t)},resetDefault:function(){this.users=[]}}},m=i("XyMi"),h=Object(m.a)(u,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b-modal",{ref:"myModalRef",attrs:{id:"modal-detail",size:"lg","hide-footer":"",static:""},on:{show:function(e){t.loading=!0},shown:t.getUsersByMasterProfileId,hidden:t.resetDefault}},[i("div",{attrs:{slot:"modal-title"},slot:"modal-title"},[t._v("\n      Danh sách tất cả user của master profile\n    ")]),t._v(" "),t.users.length>0?i("div",{staticClass:"mb-3"},[i("table",{staticClass:"table mb-0 table-bordered"},[i("thead",[i("tr",[i("th",[t._v("UserId")]),t._v(" "),i("th",[t._v("username")]),t._v(" "),i("th",[t._v("Mã COD")]),t._v(" "),i("th",[t._v("Trạng thái")]),t._v(" "),i("th",[t._v("Vị trí")]),t._v(" "),i("th",[t._v("Loại hình làm việc")]),t._v(" "),i("th",[t._v("Kho")]),t._v(" "),i("th")])]),t._v(" "),i("tbody",t._l(t.users,function(e){return i("tr",{class:[e.main_profile_id===e.profileId?"table-danger":""]},[i("td",[t._v(t._s(e.userId))]),t._v(" "),i("td",[t._v(t._s(e.username))]),t._v(" "),i("td",[t._v(t._s(e.codAlias))]),t._v(" "),i("td",[t._v(t._s(t.getUserStatusName(e.status_id)))]),t._v(" "),i("td",[t._v(t._s(e.positionName))]),t._v(" "),i("td",[t._v(t._s(e.work_type_description))]),t._v(" "),i("td",[t._v(t._s(e.stationName))]),t._v(" "),i("td",[i("router-link",{staticClass:"btn btn-outline-secondary",attrs:{to:{name:"edit-user",params:{id:e.userId}}}},[i("i",{staticClass:"ion ion-md-create"})])],1)])}),0)])]):t._e(),t._v(" "),t.loading?i("div",[t._v("\n      Dữ liệu đang loading...\n    ")]):t._e(),t._v(" "),i("div",[i("b-row",[i("b-col",{attrs:{md:"2","offset-md":"10"}},[i("b-btn",{staticClass:"btn btn-outline-secondary",on:{click:t.hideModal}},[t._v("Đóng")])],1)],1)],1)])],1)},[],!1,null,null,null).exports,p=i("l48y");var f=function(t){i("teh7"),i("Ytc+")},v=Object(m.a)({name:"modal-export-master-profile",components:{},props:["titles","show"],data:function(){return{titleOptions:[],selectedTittles:[],seletedAll:!1}},created:function(){this.setTitleOptions()},watch:{titles:function(t,e){this.setTitleOptions(),this.selectAll(),this.seletedAll=!0},show:function(t,e){this.$refs["modal-export"].show()}},methods:{selectAll:function(){this.selectedTittles=this.titleOptions.map(function(t){return t.value}),this.seletedAll=!0},deselectAll:function(){this.selectedTittles=[],this.seletedAll=!1},setTitleOptions:function(){var t=this;this.titleOptions=[],this.titles.forEach(function(e){t.titleOptions.push({text:e,value:e})})},emitExport:function(){var t=this,e=[];this.titleOptions.forEach(function(i){t.selectedTittles.includes(i.value)&&e.push(i.value)}),this.$emit("handleExport",e),this.$refs["modal-export"].hide()}}},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-modal",{ref:"modal-export",attrs:{size:"lg",title:"XUẤT DỮ LIỆU MASTER PROFILE","hide-footer":"",static:""}},[i("div",[i("b-row",[i("b-col",{attrs:{md:"8"}},[i("b",[t._v("Chọn trường thông tin cần xuất")])]),t._v(" "),i("b-col",{staticClass:"text-right",attrs:{md:"4"}},[t.seletedAll?i("b-btn",{attrs:{size:"sm",variant:"outline-primary"},on:{click:t.deselectAll}},[t._v("BỎ CHỌN TẤT CẢ")]):i("b-btn",{attrs:{size:"sm",variant:"primary"},on:{click:t.selectAll}},[t._v("CHỌN TẤT CẢ")])],1)],1),t._v(" "),i("b-form-group",[i("b-form-checkbox-group",{staticClass:"option-wraper",attrs:{name:"flavour-1"},model:{value:t.selectedTittles,callback:function(e){t.selectedTittles=e},expression:"selectedTittles"}},t._l(t.titles,function(e){return i("b-form-checkbox",{key:e,staticClass:"customized-option",attrs:{value:e}},[t._v(t._s(e))])}),1)],1)],1),t._v(" "),i("div",{staticClass:"text-center"},[i("b-button",{staticStyle:{"max-width":"500px"},attrs:{variant:"primary"},on:{click:t.emitExport}},[i("i",{staticClass:"ion ion-md-print",attrs:{"data-v-0a18351a":""}}),t._v(" XUẤT DỮ LIỆU\n        ")])],1)])},[],!1,f,"data-v-0205c26f",null).exports,g=i("QKlT"),_=i.n(g),b=i("PJh5"),x=i.n(b),y={name:"master-profile-manager",components:{SingleSelectProfileRegion:p.a,SkRotatingPlane:s.a,SingleSelectProvince:o.a,SingleSelectStation:r.a,SingleSelectPosition:l.a,SingleSelectDepartment:d.a,ModalDetailMasterProfile:h,ModalExportMasterProfile:v,flatPickr:_.a},data:function(){return{keyword:"",cmnd:"",codAlias:"",region:"",provinceId:"",stationId:"",departmentName:"",departmentId:"",positionId:"",masterProfileId:"",profiles:[],appLoading:!1,firstTime:!0,currentPage:1,totalItems:0,perPage:10,status:"",cnbConfirmStatus:"",statusOptions:n.a.getStatusOptions(),cnbConfirmStatusOptions:[{value:"",text:"Trạng thái xác nhận hồ sơ"},{value:1,text:"Đã xác nhận"},{value:2,text:"Đã có thông tin"},{value:0,text:"Chưa có thông tin"}],range_time_filter:null,range_time:null,rangeConfig:{mode:"range",altInput:!0,dateFormat:"d-m-Y",altFormat:"d-m-Y"},range_time_filter_options:[{value:null,text:"Options áp dụng time"},{value:"created_time",text:"Ngày tạo user"},{value:"join_date",text:"Ngày vào"},{value:"resign_date",text:"Ngày nghỉ việc"}],toggleExportModalShow:!1,URLExportedFile:"#",exportRight:!1,exporting:!1,exported:!1,exportTitles:[],downloaded:!0}},created:function(){this.baywatch(["cmnd","keyword","region","provinceId","stationId","departmentName","positionId","status","cnbConfirmStatus","range_time_filter","range_time"],this.allowExport.bind(this)),window.addEventListener("beforeunload",this.onCloseHandler),this.getExportPermission(),this.search()},computed:{totalPages:function(){return Math.ceil(this.totalItems/this.perPage)}},watch:{},methods:{baywatch:function(t,e){t.forEach(function(t){this.$watch(t,e)},this)},onCloseHandler:function(t){this.exporting&&(this.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo",text:"File đang được xuất, đóng cửa sổ sẽ làm mất file"}),t.returnValue="File đang được xuất, đóng cửa sổ sẽ làm mất file"),this.downloaded||(this.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo",text:"File được xuất chưa được tải về, đóng cửa sổ sẽ làm mất file"}),t.returnValue="File được xuất chưa được tải về, đóng cửa sổ sẽ làm mất file")},getExportPermission:function(){var t=this;a.a.getPermissionExportMasterProfile().then(function(e){e.data.success&&(t.exportRight=e.data.allowed,t.getTitlesExport())})},getTitlesExport:function(){var t=this;a.a.getTitlesToExportMasterProfile().then(function(e){e.data.success&&(t.exportTitles=e.data.data)})},allowExport:function(){this.exporting||(this.downloaded||confirm("Bạn chưa tải về file đã xuất. Bạn chắc chắn muốn tiếp tục?"))&&(this.exporting=!1,this.exported=!1,this.downloaded=!0,this.URLExportedFile="#")},showExportModal:function(){this.toggleExportModalShow=!this.toggleExportModalShow},searchProfile:function(){this.currentPage=1,this.search()},getStartEndFromTimeRange:function(){if(!this.range_time)return{};var t=this.range_time.split("to").map(function(t){return t.trim()});return 2===t.length?{startTime:x()(t[0],"DD-MM-YYYY").format("YYYY-MM-DD"),endTime:x()(t[1],"DD-MM-YYYY").format("YYYY-MM-DD")}:void 0},search:function(){var t=this;if(this.validate()){this.appLoading=!0;var e=this.getStartEndFromTimeRange(),i={cmnd:this.cmnd,keyword:this.keyword,codAlias:this.codAlias,region:this.region,provinceId:this.provinceId,stationId:this.stationId,departmentId:this.departmentId,positionId:this.positionId,status:this.status,cnbConfirmStatus:this.cnbConfirmStatus,timeFilterType:this.range_time_filter,startTime:e.startTime,endTime:e.endTime,page:this.currentPage,limit:this.perPage};a.a.getMasterProfileList(i).then(function(e){e.data.success&&(t.profiles=e.data.data.data,t.totalItems=e.data.data.total)}).catch(function(t){console.log(t)}).then(function(){t.appLoading=!1}),this.firstTime=!1}else this.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo lỗi",text:"CMND phải nhập đủ hoặc username phải nhập ít nhất 3 kí tự"})},handleSelectedRegion:function(t){this.region=t?t.id:""},handleSelectedProvince:function(t){this.provinceId=t?t.id:""},handleSelectedStation:function(t){this.stationId=t?t.id:""},handleSelectedDepartment:function(t){this.departmentId=t?t.id:""},handleSelectedPosition:function(t){this.positionId=t?t.id:""},validate:function(){var t=0===this.cmnd.length||this.cmnd.length>=8,e=0===this.keyword.length||this.keyword.length>=3;return!(!t||!e)},deleteProfile:function(t){var e=this;confirm("Bạn có chắc chắn muốn xóa profile "+t.fullname+" - code: "+t.staff_code+" ?")&&(this.$startLoading(),a.a.deleteProfile(t.id).then(function(t){t.data.success?(e.$notify({group:"default",type:"bg-success text-white",title:"Thông báo",text:"Xóa profile thành công!"}),e.search()):e.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo",text:t.data.message})}).catch(function(t){console.log(t),e.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo",text:"Có lỗi xảy ra trong quá trình xóa profile."})}).then(function(){e.appLoading=!1,e.$stopLoading()}))},getBriefStatusName:function(t){return n.a.getBriefStatusName(t)},getBriefStatusClass:function(t){return n.a.getBriefStatusClass(t)},setDownloaded:function(){this.downloaded=!0},checkJobStatus:function(t){var e=this,i=setInterval(function(){a.a.checkJobStatus({job_id:t}).then(function(t){t.data.success?"closed"===t.data.job_status&&(clearInterval(i),t.data.message?e.$notify({group:"default",type:"text-dark bg-warning",title:"Xảy ra lỗi",text:t.data.message}):(e.exported=!0,e.URLExportedFile=t.data.file_path,e.$notify({group:"default",type:"text-white bg-primary",title:"Xuất file thành công",text:"Đã xuất xong file dữ liệu"}),e.downloaded=!1),e.exporting=!1):(e.$notify({group:"default",type:"text-dark bg-warning",title:"Xảy ra lỗi",text:t.data.message}),clearInterval(i),e.exporting=!1)})},2e3)},exportMasterProfile:function(t){var e=this,i=this.getStartEndFromTimeRange(),n={cmnd:this.cmnd,keyword:this.keyword,region:this.region,provinceId:this.provinceId,stationId:this.stationId,departmentId:this.departmentId,positionId:this.positionId,status:this.status,cnbConfirmStatus:this.cnbConfirmStatus,titles:t,timeFilterType:this.range_time_filter,startTime:i.startTime,endTime:i.endTime};this.exporting=!0,a.a.exportMasterProfile(n).then(function(t){t.data.success?e.checkJobStatus(t.data.job_id):(e.$notify({group:"default",type:"text-dark bg-warning",title:"Xảy ra lỗi",text:t.data.message}),e.exporting=!1)})}}};var k=function(t){i("oQE1"),i("OEkN")},C=Object(m.a)(y,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"ui-block"},[i("h4",{staticClass:"ui-block-heading"},[t._v("Quản lý profile chính của nhân viên")]),t._v(" "),i("hr"),t._v(" "),i("div",{staticClass:"mb-2"},[i("b-row",{staticClass:"h-col-50"},[i("b-col",{attrs:{md:"2"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.cmnd,expression:"cmnd"}],staticClass:"form-control",attrs:{placeholder:"CMND/Mã Profile",type:"number",min:"9",max:"12"},domProps:{value:t.cmnd},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchProfile(e)},input:function(e){e.target.composing||(t.cmnd=e.target.value)}}})]),t._v(" "),i("b-col",{attrs:{md:"2"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],staticClass:"form-control",attrs:{type:"text",placeholder:"username, Họ tên"},domProps:{value:t.keyword},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchProfile(e)},input:function(e){e.target.composing||(t.keyword=e.target.value)}}})]),t._v(" "),i("b-col",{staticClass:"mb-2",attrs:{md:"2"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.codAlias,expression:"codAlias"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Mã COD"},domProps:{value:t.codAlias},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchProfile(e)},input:function(e){e.target.composing||(t.codAlias=e.target.value)}}})]),t._v(" "),i("b-col",{attrs:{md:"2"}},[i("single-select-profile-region",{on:{handleSelectedRegion:t.handleSelectedRegion}},[t._v(">")])],1),t._v(" "),i("b-col",{attrs:{md:"2"}},[i("single-select-province",{on:{handleSelectedProvince:t.handleSelectedProvince}})],1),t._v(" "),i("b-col",{attrs:{md:"2"}},[i("single-select-station",{attrs:{"province-id":t.provinceId},on:{handleSelectedStation:t.handleSelectedStation}})],1),t._v(" "),i("b-col",{attrs:{md:"2"}},[i("single-select-department",{on:{handleSelectedDepartment:t.handleSelectedDepartment}})],1),t._v(" "),i("b-col",{staticClass:"mb-2",attrs:{md:"2"}},[i("single-select-position",{attrs:{"department-id":t.departmentId},on:{handleSelectedPosition:t.handleSelectedPosition}})],1),t._v(" "),i("b-col",{staticClass:"mb-2",attrs:{md:"2"}},[i("b-form-select",{attrs:{options:t.cnbConfirmStatusOptions},model:{value:t.cnbConfirmStatus,callback:function(e){t.cnbConfirmStatus=e},expression:"cnbConfirmStatus"}})],1),t._v(" "),i("b-col",{staticClass:"mb-2",attrs:{md:"2"}},[i("b-form-select",{attrs:{options:t.statusOptions},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1),t._v(" "),i("b-col",{staticClass:"mb-2",attrs:{md:"2"}},[i("b-form-select",{attrs:{options:t.range_time_filter_options},model:{value:t.range_time_filter,callback:function(e){t.range_time_filter=e},expression:"range_time_filter"}})],1),t._v(" "),i("b-col",{staticClass:"mb-2",attrs:{md:"2"}},[i("flat-pickr",{attrs:{config:t.rangeConfig,placeholder:"Chọn khoảng thời gian"},model:{value:t.range_time,callback:function(e){t.range_time=e},expression:"range_time"}})],1)],1),t._v(" "),i("b-row",[i("b-col",{staticClass:"text-right",attrs:{md:"12"}},[i("b-btn",{attrs:{type:"button",variant:"primary"},on:{click:function(e){return t.searchProfile()}}},[i("i",{staticClass:"sidenav-icon ion ion-md-search"}),t._v(" Tìm kiếm")]),t._v(" "),t.exportRight?i("div",{staticClass:"d-inline-block ml-1"},[t.exporting?i("b-btn",{staticClass:"exporting-btn",attrs:{variant:"outline-success"}},[i("span",[i("div",{staticClass:"sk-folding-cube sk-primary"},[i("div",{staticClass:"sk-cube1 sk-cube"}),t._v(" "),i("div",{staticClass:"sk-cube2 sk-cube"}),t._v(" "),i("div",{staticClass:"sk-cube4 sk-cube"}),t._v(" "),i("div",{staticClass:"sk-cube3 sk-cube"})]),t._v("\n              Đang xuất...")])]):t.exported?i("div",{staticClass:"d-inline-block",on:{click:t.setDownloaded}},[i("b-btn",{attrs:{variant:"success",href:t.URLExportedFile,target:"blank"}},[i("i",{staticClass:"ion ion-md-download"}),t._v(" Tải xuống\n              ")])],1):i("b-btn",{attrs:{variant:"outline-success"},on:{click:t.showExportModal}},[i("i",{staticClass:"ion ion-md-print"}),t._v(" Xuất dữ liệu\n            ")])],1):t._e(),t._v(" "),i("router-link",{staticClass:"btn btn-outline-info ml-1",attrs:{to:{name:"update-main-profile"}}},[i("i",{staticClass:"ion ion-ios-construct"}),t._v(" Gộp tài khoản cùng profile")])],1)],1)],1),t._v(" "),i("div",{staticClass:"mb-3"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.appLoading,expression:"appLoading"}],staticClass:"wrapper-list-master"},[t.profiles.length>0?i("b-card",{attrs:{"no-body":""}},[i("table",{staticClass:"table mb-0 table-hover table-bordered"},[i("thead",[i("tr",[i("th",[t._v("STT")]),t._v(" "),i("th",[t._v("Mã nhân viên")]),t._v(" "),i("th",[t._v("fullname")]),t._v(" "),i("th",[t._v("CMND")]),t._v(" "),i("th",[t._v("username")]),t._v(" "),i("th",[t._v("Vị trí")]),t._v(" "),i("th",[t._v("Loại hình làm việc")]),t._v(" "),i("th",[t._v("Kho")]),t._v(" "),i("th",[t._v("Trạng thái hồ sơ")]),t._v(" "),i("th",[t._v("Action")])])]),t._v(" "),i("tbody",t._l(t.profiles,function(e,a){return i("tr",[i("td",[t._v(t._s((t.currentPage-1)*t.perPage+a+1))]),t._v(" "),i("td",[t._v(t._s(e.staff_code))]),t._v(" "),i("td",[e.image_profile?i("img",{staticClass:"img-circle",staticStyle:{"border-radius":"50%"},attrs:{src:e.image_profile,width:"35",height:"35",alt:"avatar"}}):t._e(),t._v("\n                     "+t._s(e.fullname)+"\n                ")]),t._v(" "),i("td",[t._v(t._s(e.cmnd))]),t._v(" "),i("td",[t._v(t._s(e.username))]),t._v(" "),i("td",[t._v(t._s(e.positionName))]),t._v(" "),i("td",[t._v(t._s(e.work_type_description))]),t._v(" "),i("td",[t._v(t._s(e.stationName))]),t._v(" "),i("td",[i("span",{class:t.getBriefStatusClass(e.cnb_confirmed)},[t._v(t._s(t.getBriefStatusName(e.cnb_confirmed)))])]),t._v(" "),i("td",[i("b-btn",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-detail",modifiers:{"modal-detail":!0}}],staticClass:"btn btn-md btn-outline-info",on:{click:function(i){t.masterProfileId=e.id}}},[i("i",{staticClass:"ion ion-md-eye"})]),t._v(" "),i("router-link",{staticClass:"btn btn-outline-secondary",attrs:{to:{name:"edit-master-profile",params:{id:e.id}}}},[i("i",{staticClass:"ion ion-md-create"})]),t._v(" "),i("router-link",{staticClass:"btn btn-success",attrs:{to:{name:"add-user",params:{id:e.id}}}},[i("i",{staticClass:"ion ion-md-add"})]),t._v(" "),i("b-btn",{staticClass:"btn btn-md btn-outline-danger",on:{click:function(i){return t.deleteProfile(e)}}},[i("i",{staticClass:"ion ion-md-trash"})])],1)])}),0)]),t._v(" "),t.totalPages>1?i("div",{staticClass:"mt-3"},[i("b-row",[i("b-col",{attrs:{md:"6"}},[i("b-pagination",{attrs:{"total-rows":t.totalItems,"per-page":t.perPage},on:{input:t.search},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),t._v(" "),i("b-col",{attrs:{md:"6"}},[i("span",{staticClass:"text-muted"},[t._v("Trang "+t._s(t.currentPage)+" trên "+t._s(t.totalPages))])])],1)],1):t._e(),t._v(" "),i("modal-detail-master-profile",{attrs:{masterProfileId:t.masterProfileId}})],1):t._e(),t._v(" "),!1===t.appLoading&&0===t.profiles.length&&!1===t.firstTime?i("div",[i("span",{staticClass:"pl-3 font-weight-bold"},[t._v("Rất tiếc, không tìm thấy profile phù hợp.")])]):t._e()],1)])]),t._v(" "),i("modal-export-master-profile",{attrs:{titles:t.exportTitles,show:t.toggleExportModalShow},on:{handleExport:t.exportMasterProfile}})],1)},[],!1,k,"data-v-4d69d3e1",null);e.default=C.exports},"Ytc+":function(t,e){},oQE1:function(t,e){}});