webpackJsonp([62],{"+eZl":function(t,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=s("PJh5"),i=s.n(n),e=s("IC97"),o=s("RUzx"),c=s.n(o),l=s("N4aP"),d=s("qaB4"),u=s("mCOD"),r=s("KVzY"),h=s("7+uW"),p=s("mtWM"),g=s.n(p),m=s("4WGu");h.default.use(r.default);var b={components:{Datepicker:e.a,Multiselect:c.a,LaddaBtn:d.a,LoadingMiniBottom:u.a},methods:{customFormatter:function(t){return i()(t).format("YYYY-MM-DD")},customFormatterMonth:function(t){return i()(t).format("YYYY-MM")},dateSelectedFromInChild:function(t){this.from=t},dateSelectedToInChild:function(t){this.to=t},monthSelectedInChild:function(t){this.monthDeduction=t},removeShop:function(t){if(confirm("Bạn chắc chắn muốn xóa thông tin chiết khấu của shop "+t.shop_code+"?")){var a=this;a.loadingExcel=!0,g.a.get(m.a.baseApiUrl+"deduction-manager/removeShopDDAgain/"+t.id).then(function(s){s.data.success?(a.loadingExcel=!1,a.searchShop(a.pageData.currentPage,!0,7),a.successRun=!0,a.dismissCountDownSE=a.dismissSeconds,a.msgNotify=s.data.message?s.data.message:"Xóa thông tin chiết khấu shop "+t.shop_code+" thành công."):(a.loadingExcel=!1,alert("Không thể xóa thông tin chiết khấu shop "+t.shop_code+", vui lòng kiểm tra lại!"))})}},runDD:function(){var t=this;if(confirm("Bạn muốn chạy lại chiết khấu "+t.customFormatterMonth(this.monthDeduction)+" cho các shop này?")){var a={month_deduction:t.customFormatterMonth(this.monthDeduction),stt:t.deductions.stt};t.loadingExcel=!0,t.successRun=!1,t.errorRun=!1,l.a.runDeduction(a).then(function(a){a.data.success?(t.selectDeductionStatus=[],t.selectDeductionStatus={name:"Đang chạy lại",dd_stt:"2"},t.searchShop(t.pageData.currentPage,!0,7),t.successRun=!0,t.dismissCountDownSE=t.dismissSeconds,t.msgNotify=a.data.message?a.data.message:"Chạy lại chiết khấu thành công. Vui lòng chờ hệ thống hoàn tất quá trình chiết khấu!"):(t.errorRun=!0,t.dismissCountDownEE=t.dismissSeconds,t.msgNotify=a.data.message?a.data.message:"Có lỗi xảy ra. Hãy thử lại nhé!")}).catch(function(t){}).then(function(){t.loadingExcel=!1})}},exportFileDD:function(){var t=this,a={month_deduction:t.customFormatterMonth(this.monthDeduction)};t.loadingExcel=!0,l.a.exportFileDD(a).then(function(t){if(t.data.success)window.location.href=t.data.data;else{var a=t.data.msg?t.data.msg:"Có lỗi xảy ra. Hãy thử lại nhé!";alert(a)}}).catch(function(t){t&&alert("Có lỗi xảy ra. Hãy thử lại nhé!")}).then(function(){t.loadingExcel=!1})},exportFileZip:function(){var t=this,a={month_deduction:t.customFormatterMonth(this.monthDeduction)};t.loadingExcel=!0,l.a.exportFileZip(a).then(function(t){if(t.data.success)window.location.href=t.data.data;else{var a=t.data.msg?t.data.msg:"Có lỗi xảy ra. Hãy thử lại nhé!";alert(a)}}).catch(function(t){t&&alert("Có lỗi xảy ra. Hãy thử lại nhé!")}).then(function(){t.loadingExcel=!1})},showImportModal:function(){this.resetModal(),this.$refs.importExcelModal.show()},hideImportModal:function(){this.$refs.importExcelModal.hide()},uploadFile:function(t){var a=this;if(a.importFile){var s=this.importFile.name.split(".").pop();if(console.log(s),["xlsx","xls"].indexOf(s)<0)alert("Bạn phải upload file định dạng Excel .xlsx hoặc .xls !");else{var n=new FormData;n.append("file_upload",a.importFile),a.uploadMsg="",a.startLoading(t),l.a.uploadFileDDAgain(n).then(function(s){s.data.success?(a.isUploadSuccess=1,s.data.message&&(a.uploadMsg=s.data.message),a.updateLoadingValue(t,!1)):(a.isUploadSuccess=-1,s.data.message&&(a.uploadMsg=s.data.message),a.updateLoadingValue(t,!1))}).catch(function(s){s&&(a.isUploadSuccess=-1,a.updateLoadingValue(t,!1))}).then(function(){a.updateLoadingValue(t,!1),a.appLoading=!1})}}else alert("Bạn chưa chọn file upload!")},searchShop:function(t,a,s){var n=this,i={month_deduction:n.customFormatterMonth(this.monthDeduction),dd_stt:n.selectDeductionStatus.dd_stt,page:t};a&&(this.pageData.currentPage=1,i.page=1),n.appLoading=!0,this.startLoading(s),l.a.searchShop(i).then(function(t){t.data.success?(n.checkResult=t.data.success,n.pageData.totalItems=t.data.options.total,n.pageData.perPage=t.data.options.per_page,n.pageData.totalPages=t.data.options.total_page,n.listShops=t.data.options.shops,n.canRunDD=t.data.options.canRunDD,n.listShops.length>0?"1"===n.selectDeductionStatus.dd_stt?(n.btnDisablerunDD=!1,n.btnDisableDD=!0,n.btnDisableZip=!0):"2"===n.selectDeductionStatus.dd_stt?(n.btnDisablerunDD=!0,n.btnDisableDD=!0,n.btnDisableZip=!0):"3"===n.selectDeductionStatus.dd_stt&&(n.btnDisablerunDD=!0,n.btnDisableDD=!1,n.btnDisableZip=!1):(n.btnDisablerunDD=!0,n.btnDisableDD=!0,n.btnDisableZip=!0),n.updateLoadingValue(s,!1)):n.updateLoadingValue(s,!1)}).catch(function(t){t&&n.updateLoadingValue(s,!1)}).then(function(){n.updateLoadingValue(s,!1),n.appLoading=!1})},resetModal:function(){this.isUploadSuccess=0,this.uploadMsg="",this.$refs.importFile.reset()},startLoading:function(t){this.loading[t]||this.updateLoadingValue(t,!0)},updateLoadingValue:function(t,a){this.loading[t]=a,this.loading=this.loading.slice(0)},pageChanged:function(t){this.searchShop(t),this.pageData.currentPage=t},redirectDownload:function(){window.open("/adm/download-manage?type=ar")}},data:function(){return{from:i()().format("YYYY-MM-DD"),to:i()().format("YYYY-MM-DD"),monthDeduction:i()().subtract(1,"month").format("YYYY-MM"),selected:{shops:[]},deductions:{stt:""},selectDeductionStatus:{name:"Chưa chạy lại",dd_stt:"1"},DeductionStt:[{name:"Chưa chạy lại",dd_stt:"1"},{name:"Đang chạy lại",dd_stt:"2"},{name:"Đã chạy xong",dd_stt:"3"}],loading:[!1,!1],loadingExcel:!1,loadingExcelHtml:'\n     <div class="sk-folding-cube sk-primary">\n       <div class="sk-cube1 sk-cube"></div>\n       <div class="sk-cube2 sk-cube"></div>\n       <div class="sk-cube4 sk-cube"></div>\n       <div class="sk-cube3 sk-cube"></div>\n     </div>\n     <h5 class="text-center mb-0">LOADING...</h5>\n    ',pageData:{currentPage:1,totalPages:0,totalItems:0,perPage:10,sortBy:"id",sortDesc:!1},isUploadSuccess:0,appLoading:!1,listShops:[],checkResult:!1,uploadMsg:"",importFile:null,successRun:!1,errorRun:!1,dismissSeconds:3,dismissCountDownSE:0,dismissCountDownEE:0,msgNotify:"",btnDisableDD:!0,btnDisableZip:!0,btnDisablerunDD:!0,canRunDD:!1}}},v=s("XyMi");var D=function(t){s("XSOw")},_=Object(v.a)(b,function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",[s("div",[s("div",{staticClass:"ui-block"},[s("h4",{staticClass:"ui-block-heading text-center"},[t._v("Chạy lại chiết khấu Shop")]),t._v(" "),s("div",{staticClass:"col-md-6 center"},[s("b-button",{staticClass:"btn btn-success",on:{click:t.showImportModal}},[s("i",{staticClass:"sidenav-icon ion ion-md-cloud-upload"}),t._v("\n                    Upload thông tin shop\n                ")])],1)]),t._v(" "),s("form",[s("b-form-row",[s("div",{staticClass:"col-md-6"},[s("b-form-group",{attrs:{label:"Chọn tháng tính chiết khấu:"}},[s("datepicker",{staticClass:"month-deduction",attrs:{"minimum-view":"month","maximum-view":"month",bootstrapStyling:!0,format:t.customFormatterMonth},on:{selected:t.monthSelectedInChild},model:{value:t.monthDeduction,callback:function(a){t.monthDeduction=a},expression:"monthDeduction"}})],1)],1),t._v(" "),s("div",{staticClass:"col-md-6"},[s("b-form-group",{attrs:{label:"Trạng thái:"}},[s("multiselect",{attrs:{id:"input_deduction_stt","track-by":"name",label:"name",placeholder:"Chọn trạng thái",options:t.DeductionStt,searchable:!1,"allow-empty":!1},model:{value:t.selectDeductionStatus,callback:function(a){t.selectDeductionStatus=a},expression:"selectDeductionStatus"}})],1)],1)]),t._v(" "),s("b-form-row",[!t.btnDisablerunDD&&t.canRunDD?s("div",{staticClass:"col-md-6",attrs:{disabled:t.btnDisablerunDD}},[s("b-form-group",{attrs:{label:"Số thứ tự chiết khấu:"}},[s("b-input",{attrs:{type:"text",placeholder:"Nhập số thứ tự file chiết khấu"},model:{value:t.deductions.stt,callback:function(a){t.$set(t.deductions,"stt",a)},expression:"deductions.stt"}})],1)],1):t._e()]),t._v(" "),s("b-form-row",[s("div",{staticClass:"align-content-center center"},[t.loadingExcel?s("BlockUI",{attrs:{message:"Dữ liệu đang được xử lý, vui lòng đợi!",html:t.loadingExcelHtml}}):t._e(),t._v(" "),s("ladda-btn",{staticClass:"btn btn-success",attrs:{loading:t.loading[1],"data-style":"zoom-out"},nativeOn:{click:function(a){return t.searchShop(t.pageData.currentPage,!0,1)}}},[s("i",{staticClass:"sidenav-icon ion ion-md-search"}),t._v("\n                        Thông tin shop\n                    ")]),t._v(" "),!t.btnDisablerunDD&&t.canRunDD?s("b-btn",{staticClass:"btn btn-danger",attrs:{disabled:t.btnDisablerunDD,type:"button"},on:{click:t.runDD}},[s("i",{staticClass:"sidenav-icon ion ion-md-play"}),t._v("\n                        Chạy chiết khấu\n                    ")]):t._e(),t._v(" "),t.btnDisableDD?t._e():s("b-btn",{staticClass:"btn btn-primary",attrs:{disabled:t.btnDisableDD,type:"button"},on:{click:t.exportFileDD}},[s("i",{staticClass:"sidenav-icon ion ion-md-cloud-download"}),t._v("\n                        Tải file kết quả CK\n                    ")]),t._v(" "),t.btnDisableZip?t._e():s("b-btn",{staticClass:"btn btn-danger",attrs:{disabled:t.btnDisableZip,type:"button"},on:{click:t.exportFileZip}},[s("i",{staticClass:"sidenav-icon ion ion-md-cloud-download"}),t._v("\n                        Tải file zip chiết khấu\n                    ")])],1)])],1)]),t._v(" "),t.successRun?s("div",[s("b-alert",{attrs:{show:t.dismissCountDownSE,dismissible:"",variant:"success"},on:{dismissed:function(a){t.dismissCountDownSE=0}}},[t._v("\n            "+t._s(t.msgNotify)+"\n        ")])],1):t._e(),t._v(" "),t.errorRun?s("div",[s("b-alert",{attrs:{show:t.dismissCountDownEE,dismissible:"",variant:"warning"},on:{dismissed:function(a){t.dismissCountDownEE=0}}},[t._v("\n            "+t._s(t.msgNotify)+"\n        ")])],1):t._e(),t._v(" "),t.checkResult?s("div",{staticClass:"result",attrs:{id:"results"}},[t.listShops.length>0?s("b-card",{attrs:{"no-body":""}},[s("div",{staticClass:"table-result"},[s("b-card-body",{staticClass:"pt-0 pb-3"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-sm pt-3"},[s("b-pagination",{attrs:{"total-rows":t.pageData.totalItems,"per-page":t.pageData.perPage},on:{change:t.pageChanged},model:{value:t.pageData.currentPage,callback:function(a){t.$set(t.pageData,"currentPage",a)},expression:"pageData.currentPage"}}),t._v("\n                            Tổng số shop: "+t._s(t.pageData.totalItems)+"\n                        ")],1),t._v(" "),s("div",{staticClass:"col-sm text-sm-left text-center pt-3"},[t.pageData.totalItems?s("span",{staticClass:"text-muted"},[t._v("Trang "+t._s(t.pageData.currentPage)+" trên "+t._s(t.pageData.totalPages))]):t._e()])])]),t._v(" "),s("div",{staticClass:"table-responsive mb-4"},[s("table",{staticClass:"table mb-0 table-bordered table-striped"},[s("thead",{staticStyle:{width:"100%"}},[s("tr",[s("th",{attrs:{width:"50%"}},[t._v("Thông tin shop")]),t._v(" "),s("th",{attrs:{width:"45%"}},[t._v("Thông tin chiết khấu")]),t._v(" "),s("th",{attrs:{width:"5%"}},[t._v("Thao tác")])])]),t._v(" "),s("tbody",t._l(t.listShops,function(a){return s("tr",{staticClass:"tr-bill"},[s("td",[s("span",{staticClass:"font-weight-bold"},[t._v("Mã shop: ")]),t._v(" "),s("span",{staticClass:"badge align-text-bottom badge-success"},[t._v(" "+t._s(a.DeductionShopAgain.shop_code)+" - "+t._s(a.Shop.name))]),t._v(" "),s("br"),s("br"),t._v(" "),s("span",{staticClass:"font-weight-bold"},[t._v("Gói chiết khấu: ")]),t._v(" "+t._s(a.Deduction.name)),s("br"),t._v(" "),s("span",{staticClass:"font-weight-bold"},[t._v("Mã gói CK: ")]),t._v(" "+t._s(a.DeductionShopAgain.dd_id)),s("br"),t._v(" "),s("span",{staticClass:"font-weight-bold"},[t._v("Thời gian áp dụng: ")]),t._v(" "+t._s(a.DeductionShopAgain.date_from)),s("br"),t._v(" "),s("span",{staticClass:"font-weight-bold"},[t._v("Thời gian kết thúc: ")]),t._v(" "+t._s(a.DeductionShopAgain.date_to)),s("br"),t._v(" "),s("br"),t._v(" "),s("span",{staticClass:"font-weight-bold"},[t._v("Thời gian upload: ")]),t._v(" "+t._s(a.DeductionShopAgain.created)),s("br")]),t._v(" "),s("td",[s("span",{staticClass:"font-weight-bold"},[t._v("Trạng thái: ")]),t._v(" "),1==a.DeductionShopAgain.status?s("span",{staticClass:"badge align-text-bottom badge-danger"},[t._v("Chưa chạy lại")]):t._e(),t._v(" "),2==a.DeductionShopAgain.status?s("span",{staticClass:"badge align-text-bottom badge-warning"},[t._v("Đang chạy lại")]):t._e(),t._v(" "),3==a.DeductionShopAgain.status?s("span",{staticClass:"badge align-text-bottom badge-success"},[t._v("Đã chạy xong")]):t._e(),t._v(" "),1==a.DeductionShopAgain.is_dd?s("span",{staticClass:"badge align-text-bottom badge-success"},[t._v("Được chiết khấu")]):t._e(),t._v(" "),2==a.DeductionShopAgain.is_dd?s("span",{staticClass:"badge align-text-bottom badge-danger"},[t._v("Không được chiết khấu")]):t._e(),t._v(" "),s("br"),s("br"),t._v(" "),s("span",{staticClass:"font-weight-bold"},[t._v("Số đơn đủ điều kiện CK: ")]),t._v(" "+t._s(a.DeductionShopAgain.number_pkg)),s("br")]),t._v(" "),s("td",[t.canRunDD&&1==a.DeductionShopAgain.status?s("i",{staticClass:"sidenav-icon ion ion-ios-trash",on:{click:function(s){return t.removeShop(a.DeductionShopAgain)}}}):t._e()])])}),0)])])],1)]):t._e(),t._v(" "),0==t.listShops.length?s("div",{staticClass:"no-data"},[s("b-alert",{attrs:{show:"",dismissible:"",variant:"warning"}},[s("i",{staticClass:"sidenav-icon ion ion-ios-warning"}),t._v("\n                Không có dữ liệu phù hợp, vui lòng thử lại.\n            ")])],1):t._e()],1):t._e(),t._v(" "),s("loading-mini-bottom",{attrs:{enable:t.appLoading}}),t._v(" "),s("b-modal",{ref:"importExcelModal",attrs:{title:"Import Excel Shop Deduction Info",static:""}},[s("div",{staticClass:"d-block text-center"},[1==t.isUploadSuccess?s("b-alert",{attrs:{variant:"success",show:""}},[t._v(t._s(t.uploadMsg?t.uploadMsg:"Upload file thành công"))]):t._e(),t._v(" "),-1==t.isUploadSuccess?s("b-alert",{attrs:{variant:"danger",show:""}},[t._v(t._s(t.uploadMsg?t.uploadMsg:"Upload file không thành công"))]):t._e(),t._v(" "),s("b-form-file",{ref:"importFile",attrs:{variant:"outline-default",state:Boolean(t.importFile),placeholder:"Chọn file...",accept:".xls*"},model:{value:t.importFile,callback:function(a){t.importFile=a},expression:"importFile"}}),t._v(" "),s("div",{staticClass:"mt-3"},[t._v("File đã chọn: "+t._s(t.importFile&&t.importFile.name))]),t._v(" "),t.importFile?s("ladda-btn",{staticClass:"btn btn-primary",attrs:{loading:t.loading[0],"data-style":"zoom-out"},nativeOn:{click:function(a){return t.uploadFile(0)}}},[s("i",{staticClass:"sidenav-icon ion ion-md-filing"}),t._v("\n                Upload\n            ")]):t._e()],1),t._v(" "),s("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("b-btn",{staticClass:"float-right",attrs:{variant:"default"},on:{click:t.hideImportModal}},[t._v("\n                Đóng\n            ")])],1)])],1)},[],!1,D,"data-v-7405aca6",null);a.default=_.exports},XSOw:function(t,a){}});