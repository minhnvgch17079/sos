webpackJsonp([41],{"6wTa":function(e,t){},WMX8:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("GyeY"),i=s("yqjn"),o=s("IC97"),n=s("RUzx"),r=s.n(n),d=s("qaB4"),c=s("mCOD"),l=s("N4aP"),p=s("KVzY"),h=s("7+uW"),u=s("5eEt"),v=s("4WGu"),g=s("mtWM"),m=s.n(g),_={name:"select-dd-shop",props:{placeholder:{type:String,default:"Chọn gói chiết khấu"}},components:{Multiselect:r.a},data:function(){return{valueDdType:"",monthExpire:"",isForever:!1,ddType:[],newSelectedDdType:"",errDdType:!1,errMonthExpire:!1,disableMonthExpire:!0,disableForever:!0}},methods:{getOptions:function(){var e=this;m.a.get(v.a.baseApiUrl+"new-deduction/getDeductionType").then(function(t){t.data.success&&(e.ddType=t.data.data.options.ddTypes)}).catch(function(e){})},onSelect:function(e){this.newSelectedDdType=e.code,this.$emit("selectedDdShop",this.newSelectedDdType),this.disableMonthExpire=!1,this.disableForever=!1,this.monthExpire=1,this.$emit("selectedMonthExpire",this.monthExpire),this.isForever=!1,this.$emit("checked4ever",this.isForever)},onRemove:function(){this.newSelectedDdType="",this.monthExpire="",this.isForever=!1,this.disableMonthExpire=!0,this.disableForever=!0,this.$emit("selectedDdShop",""),this.$emit("selectedMonthExpire",""),this.$emit("checked4ever",!1)},reset:function(){this.newSelectedDdType=""},fillOption:function(e){var t=this;l.a.fillDataDdShop(e).then(function(e){e.data.success?e.data.dd_shop.ddTypes.code?(t.ddType=e.data.ddTypes,t.monthExpire=e.data.dd_shop.monthExpire,t.isForever=e.data.dd_shop.isForever,t.valueDdType=e.data.dd_shop.ddTypes,t.newSelectedDdType=e.data.dd_shop.ddTypes.code,t.$emit("selectedDdShop",t.newSelectedDdType),t.$emit("selectedMonthExpire",t.monthExpire),t.$emit("checked4ever",t.isForever),e.data.dd_shop.isForever?(t.monthExpire="",t.$emit("selectedMonthExpire",t.monthExpire),t.disableMonthExpire=!1,t.disableForever=!0):(t.disableMonthExpire=!1,t.disableForever=!1)):(t.disableMonthExpire=!0,t.disableForever=!0,t.ddType=e.data.ddTypes,t.valueDdType="",t.monthExpire="",t.isForever=!1,t.newSelectedDdType="",t.$emit("selectedDdShop",t.newSelectedDdType),t.$emit("selectedMonthExpire",t.monthExpire),t.$emit("checked4ever",t.isForever)):alert("Có lỗi xảy ra")})},submit:function(e,t){this.errDdType=e,this.errMonthExpire=t},emitMonthExpire:function(e){this.$emit("selectedMonthExpire",this.monthExpire)},checkForever:function(e){e.target.checked?(this.isForever=e.target.checked,this.disableForever=!0,this.$emit("checked4ever",this.isForever),this.monthExpire="",this.$emit("selectedMonthExpire",self.monthExpire)):(this.isForever=!1,this.disableForever=!1,this.$emit("checked4ever",this.isForever))}}},b=s("XyMi");var f=function(e){s("6wTa")},y=Object(b.a)(_,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("b-form-group",{staticClass:"col-sm-12"},[s("label",{staticClass:"font-weight-bold"},[e._v("Gói chiết khấu mới")]),e._v(" "),s("multiselect",{class:{errorClass:e.errDdType},attrs:{options:e.ddType,multiple:!1,placeholder:e.placeholder,"track-by":"name",label:"name",selectLabel:"",selectedLabel:"",deselectLabel:"x",taggable:!0},on:{select:e.onSelect,remove:e.onRemove,open:function(t){e.errDdType=!1}},model:{value:e.valueDdType,callback:function(t){e.valueDdType=t},expression:"valueDdType"}})],1),e._v(" "),s("b-form-group",{staticClass:"col-sm-12"},[s("label",{staticClass:"font-weight-bold"},[e._v("Số tháng áp dụng")]),e._v(" "),s("b-input",{class:{errorClass:e.errMonthExpire},attrs:{placeholder:"Nhập số tháng áp dụng gói chiết khấu",type:"text",disabled:e.disableMonthExpire||e.disableForever},on:{keyup:e.emitMonthExpire},nativeOn:{keyup:function(t){e.errMonthExpire=!1}},model:{value:e.monthExpire,callback:function(t){e.monthExpire=t},expression:"monthExpire"}})],1),e._v(" "),s("b-form-group",{staticClass:"col-sm-12"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.isForever,expression:"isForever"}],attrs:{type:"checkbox",name:"is_forever"},domProps:{checked:Array.isArray(e.isForever)?e._i(e.isForever,null)>-1:e.isForever},on:{click:function(t){return e.checkForever(t)},change:function(t){var s=e.isForever,a=t.target,i=!!a.checked;if(Array.isArray(s)){var o=e._i(s,null);a.checked?o<0&&(e.isForever=s.concat([null])):o>-1&&(e.isForever=s.slice(0,o).concat(s.slice(o+1)))}else e.isForever=i}}}),e._v("\n        Luôn được áp dụng khi gán gói\n    ")])],1)},[],!1,f,"data-v-b1c636ec",null).exports,S=s("w6Ui");h.default.use(p.default);var x={components:{SelectDdType:i.a,SelectCtmCare:a.a,Datepicker:o.a,Multiselect:r.a,LaddaBtn:d.a,LoadingMiniBottom:c.a,SelectUserShop:u.a,SelectDdShop:y,SidenavRouterLink:S.g},data:function(){return{selected:{ctmCare:[],ddType:"",ddTypeShop:""},from:"",to:"",shops:{shop_code:""},loading:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],pageData:{currentPage:1,totalPages:0,totalItems:0,perPage:50,sortBy:"id",sortDesc:!1},checkResult:!1,appLoading:!1,loadingTransfer:!1,htmlTransfer:'<div class="sk-folding-cube sk-primary">\n        <div class="sk-cube1 sk-cube"></div>\n        <div class="sk-cube2 sk-cube"></div>\n        <div class="sk-cube4 sk-cube"></div>\n        <div class="sk-cube3 sk-cube"></div>\n        </div>\n        <h5 class="text-center mb-0">LOADING...</h5>',listShops:[],inputDisable:!1,packageStatuses:[],successModel:!0,ddShopId:"",sendShopCode:"",sendShopOrder:"",ddTypeId:"",monthExpire:"",isForever:"",message:[],errEditShopInfo:!1,notEmpty:"",invalidShop:"",errDdType:!1,errMonthExpire:!1,isManageAllShop:!1,successSave:!1,dismissSeconds:10,dismissCountDownSE:0,msgNotify:"",isCanEdit:!1,selectExpireType:"",expireTypes:[{name:"Đã hết thời gian áp dụng",expire_type:"expired"},{name:"Còn thời gian áp dụng",expire_type:"not_expired"},{name:"Luôn áp dụng",expire_type:"forever"}]}},methods:{resetForm:function(){this.shops.shop_code="",this.$refs.select_ctmCare.reset(),this.$refs.select_ddType.reset(),this.selectExpireType=""},searchShop:function(e,t,s){var a=this,i={shop_code:a.shops.shop_code,ctm_care_id:a.selected.ctmCare,dd_id:a.selected.ddType,expire_type:a.selectExpireType.expire_type,page:e,limit:a.pageData.perPage,is_assign:1};t&&(this.pageData.currentPage=1,i.page=1),a.loadingTransfer=!0,this.startLoading(s),l.a.searchNewDeductionShop(i).then(function(e){e.data.success?(a.checkResult=e.data.success,a.pageData.totalItems=e.data.options.total,a.pageData.perPage=e.data.options.per_page,a.pageData.totalPages=e.data.options.total_page,a.listShops=e.data.options.shops,a.isCanEdit=e.data.options.isCanEdit,a.updateLoadingValue(s,!1)):a.updateLoadingValue(s,!1)}).catch(function(e){e&&a.updateLoadingValue(s,!1)}).then(function(){a.updateLoadingValue(s,!1),a.loadingTransfer=!1})},startLoading:function(e){this.loading[e]||this.updateLoadingValue(e,!0)},updateLoadingValue:function(e,t){this.loading[e]=t,this.loading=this.loading.slice(0)},pageChanged:function(e){this.searchShop(e),this.pageData.currentPage=e},handleOk:function(e){e.preventDefault(),this.loadingTransfer=!0;var t="";this.errDdType=!1,this.errMonthExpire=!1,this.selected.ddTypeShop&&(this.monthExpire||this.isForever?this.successModel=!0:(this.errMonthExpire=!0,this.notEmpty="Không được để trống thông tin",this.successModel=!1,this.errEditShopInfo=!1,this.loadingTransfer=!1,this.$refs.select_dd_shop.submit(this.errDdType,this.errMonthExpire))),this.successModel&&(this.notEmpty="",this.successModel=!0,this.errDdType=!1,this.errMonthExpire=!1,this.$refs.select_dd_shop.submit(this.errDdType,this.errMonthExpire),t={id:this.ddShopId,dd_id:this.selected.ddTypeShop,s_order:this.sendShopOrder,month_expire:this.monthExpire,is_forever:this.isForever},this.handleSubmit(t,this.sendShopCode))},handleSubmit:function(e,t){var s=this;confirm("Bạn chắc chắn muốn cập nhật gói cam kết hoàn của shop "+t+"?")?(this.loadingTransfer=!0,this.errEditShopInfo=!1,l.a.saveDdShop(e).then(function(e){e.data.success?(s.$refs.myModalRefDdShop.hide(),s.searchShop(s.pageData.currentPage,!0,7),s.successModel=!0,s.successSave=!0,s.dismissCountDownSE=s.dismissSeconds,s.msgNotify=e.data.message):(s.loadingTransfer=!1,s.message=e.data.message_error,s.errDdType=e.data.error.errDdType,s.errMonthExpire=e.data.error.errMonthExpire,s.errEditShopInfo=!0)})):this.loadingTransfer=!1},editShopInfo:function(e,t,s,a,i,o){this.$refs.myModalRefDdShop.show(),this.errDdType=!1,this.errMonthExpire=!1,this.errEditShopInfo=!1,this.successModel=!0;var n={shop_order:t};this.ddShopId=i,this.sendShopCode=e,this.sendShopOrder=t,this.ddTypeId=s,this.monthExpire=a,this.isForever=o,this.$refs.select_dd_shop.submit(this.errDdType,this.errMonthExpire),this.$refs.select_dd_shop.fillOption(n)},redirectNewDeductionManage:function(){window.open("/adm/shops/manage-new-deduction")}},computed:{totalItems:function(){return this.listBills.length},totalPages:function(){return Math.ceil(this.totalItems/this.perPage)}},filters:{shopStatus:function(e){return e?"1"===e?"Đang làm việc":"2"===e?"Đã dừng":"3"===e?"Chưa kiểm duyệt":"Tiếp tục liên hệ":""}}};var C=function(e){s("6aA6"),s("yt+X")},D=Object(b.a)(x,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"ui-block"},[s("b-form-row",[s("h4",{staticClass:"ui-block-heading col-md-6"},[e._v("Gán gói chiết khấu")]),e._v(" "),s("div",{staticClass:"col-md-6 center"},[s("b-button",{staticClass:"btn btn-success",on:{click:e.redirectNewDeductionManage}},[s("i",{staticClass:"sidenav-icon ion ion-md-information-circle"}),e._v("\n                    Quản lý chiết khấu mới\n                ")]),e._v(" "),s("b-button",{staticClass:"btn btn-warning"},[s("sidenav-router-link",{attrs:{to:"/shops/new-deduction-result"}},[s("i",{staticClass:"sidenav-icon ion ion-md-fastforward"}),e._v("Kết quả chiết khấu")])],1)],1)]),e._v(" "),s("div",[s("form",[s("div",{staticClass:"form-filter"},[s("b-form-row",[s("div",{staticClass:"col-md-6"},[s("b-form-group",{attrs:{label:"Mã shop"}},[s("b-input",{attrs:{type:"text",placeholder:"Nhiều mã cách nhau bởi dấu phẩy. Ví dụ: S1,S2..."},model:{value:e.shops.shop_code,callback:function(t){e.$set(e.shops,"shop_code",t)},expression:"shops.shop_code"}})],1)],1),e._v(" "),s("div",{staticClass:"col-md-6"},[s("b-form-group",{attrs:{label:"CSKH"}},[s("select-ctmCare",{ref:"select_ctmCare",on:{selected:function(t){e.selected.ctmCare=t}}})],1)],1)]),e._v(" "),s("b-form-row",[s("div",{staticClass:"col-md-6"},[s("b-form-group",{attrs:{label:"Gói chiết khấu"}},[s("select-dd-type",{ref:"select_ddType",on:{selected:function(t){e.selected.ddType=t}}})],1)],1),e._v(" "),s("div",{staticClass:"col-md-6"},[s("b-form-group",{attrs:{label:"Thời gian áp dụng"}},[s("multiselect",{attrs:{"track-by":"name",label:"name",placeholder:"Chọn thời gian áp dụng",options:e.expireTypes,searchable:!1,"allow-empty":!1},model:{value:e.selectExpireType,callback:function(t){e.selectExpireType=t},expression:"selectExpireType"}})],1)],1)])],1),e._v(" "),s("b-form-row",[s("div",{staticClass:"align-content-center center"},[s("b-button",{staticClass:"btn",on:{click:e.resetForm}},[e._v("\n                            Nhập lại\n                        ")]),e._v(" "),s("ladda-btn",{staticClass:"btn btn-success",attrs:{loading:e.loading[7],"data-style":"zoom-out"},nativeOn:{click:function(t){return e.searchShop(e.pageData.currentPage,!0,7)}}},[s("i",{staticClass:"sidenav-icon ion ion-md-search"}),e._v("\n                            Tìm shop\n                        ")])],1)]),e._v(" "),s("div",[s("b-modal",{ref:"myModalRefDdShop",attrs:{title:"Sửa thông tin chiết khấu shop","modal-class":"model_bank",size:"400","ok-title":"Lưu","cancel-title":"Đóng",static:""},on:{ok:e.handleOk}},[!1===e.successModel?s("div",{staticClass:"no-data"},[s("b-alert",{attrs:{show:"",dismissible:"",variant:"warning"}},[s("i",{staticClass:"sidenav-icon ion ion-ios-warning"}),e._v("\n                                "+e._s(e.notEmpty)+"\n                            ")])],1):e._e(),e._v(" "),e._l(e.message,function(t){return e.errEditShopInfo?s("div",[s("b-alert",{attrs:{show:"",dismissible:"",variant:"warning"}},[s("i",{staticClass:"sidenav-icon ion ion-ios-warning"}),e._v("\n                                "+e._s(t)+"\n                            ")])],1):e._e()}),e._v(" "),s("form",{on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.handleSubmit(t)}}},[s("b-form-group",[s("b-form-group",{staticClass:"col mb-0"},[s("label",{staticClass:"font-weight-bold"},[e._v("Mã shop")]),e._v(" "),s("b-input",{attrs:{type:"text",disabled:!0},model:{value:e.sendShopCode,callback:function(t){e.sendShopCode=t},expression:"sendShopCode"}})],1)],1),e._v(" "),s("b-form-group",[s("select-dd-shop",{ref:"select_dd_shop",on:{selectedDdShop:function(t){e.selected.ddTypeShop=t},selectedMonthExpire:function(t){e.monthExpire=t},checked4ever:function(t){e.isForever=t}}})],1)],1)],2)],1)],1)]),e._v(" "),e.successSave?s("div",[s("b-alert",{attrs:{show:e.dismissCountDownSE,dismissible:"",variant:"success"},on:{dismissed:function(t){e.dismissCountDownSE=0}}},[e._v("\n                "+e._s(e.msgNotify)+"\n            ")])],1):e._e(),e._v(" "),e.checkResult?s("div",{staticClass:"result",attrs:{id:"results"}},[e.listShops.length>0?s("b-card",{attrs:{"no-body":""}},[s("div",{staticClass:"table-result"},[s("b-card-body",{staticClass:"pt-0 pb-3"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-sm pt-3"},[s("b-pagination",{attrs:{"total-rows":e.pageData.totalItems,"per-page":e.pageData.perPage},on:{change:e.pageChanged},model:{value:e.pageData.currentPage,callback:function(t){e.$set(e.pageData,"currentPage",t)},expression:"pageData.currentPage"}}),e._v("\n                                Tổng số shop: "+e._s(e.pageData.totalItems)+"\n                            ")],1),e._v(" "),s("div",{staticClass:"col-sm text-sm-left text-center pt-3"},[e.pageData.totalItems?s("span",{staticClass:"text-muted"},[e._v("Trang "+e._s(e.pageData.currentPage)+" trên "+e._s(e.pageData.totalPages))]):e._e()])])]),e._v(" "),s("div",{staticClass:"table-responsive mb-4"},[s("table",{staticClass:"table mb-0 table-bordered table-striped"},[s("thead",{staticStyle:{width:"100%"}},[s("tr",[s("th",{attrs:{width:"45%"}},[e._v("Thông tin shop")]),e._v(" "),s("th",{attrs:{width:"45%"}},[e._v("Thông tin chiết khấu")]),e._v(" "),s("th",{attrs:{width:"5%"}},[e._v("Thao tác")])])]),e._v(" "),s("tbody",e._l(e.listShops,function(t){return s("tr",{staticClass:"tr-bill"},[s("td",[1==t.Shop.shop_type?s("span",{staticClass:"badge align-text-bottom badge-success"},[e._v("PRO")]):e._e(),e._v(" "),2==t.Shop.shop_type?s("span",{staticClass:"badge align-text-bottom badge-danger"},[e._v("VIP")]):e._e(),e._v(" "),3==t.Shop.shop_type?s("span",{staticClass:"badge align-text-bottom badge-info"},[e._v("PRE")]):e._e(),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v(e._s(t.Shop.code)+" - "+e._s(t.Shop.name))]),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v("Số ĐT: ")]),s("span",[e._v(e._s(t.Shop.tel))]),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v("Email: ")]),s("span",[e._v(e._s(t.Shop.email))]),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v("CSKH: ")]),s("span",[e._v(e._s(t.Shop.ctm_care))]),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v("Trạng thái: ")]),s("span",[e._v(e._s(e._f("shopStatus")(t.Shop.shop_status_id)))]),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v("Thời gian tạo: ")]),s("span",[e._v(e._s(t.Shop.created))]),e._v(" "),s("br")]),e._v(" "),s("td",{staticClass:"bill-info"},[s("span",{staticClass:"font-weight-bold"},[e._v("Gói: ")]),s("span",{staticClass:"badge align-text-bottom badge-success"},[e._v(e._s(t.NewDeduction.name))]),e._v(" "),1==t.NewDeductionShop.is_forever?s("span",{staticClass:"badge align-text-bottom badge-primary"},[e._v("Luôn áp dụng")]):e._e(),s("br"),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v("Số tháng đã chạy / áp dụng: ")]),t.NewDeduction.name?s("span",{staticClass:"font-weight-bold text-danger"},[e._v("\n                                    "+e._s(t.NewDeductionShop.month_run)+" / "+e._s(t.NewDeductionShop.month_expire))]):e._e(),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v("Thời gian gán: ")]),s("span",[e._v(e._s(t.NewDeductionShop.created))]),e._v(" "),s("br"),e._v(" "),s("br"),e._v(" "),s("span",{staticClass:"font-weight-bold"},[e._v("Cập nhật: ")]),s("span",[e._v(e._s(t.NewDeductionShop.modified))])]),e._v(" "),s("td",[s("ladda-btn",{staticClass:"btn btn-success",attrs:{"data-style":"zoom-out",disabled:!e.isCanEdit},nativeOn:{click:function(s){return e.editShopInfo(t.Shop.code,t.Shop.order,t.NewDeduction.id,t.NewDeductionShop.month_expire,t.NewDeductionShop.id,t.NewDeductionShop.is_forever)}}},[s("i",{staticClass:"sidenav-icon ion ion-md-create"}),e._v("\n                                        Sửa\n                                    ")])],1)])}),0)])]),e._v(" "),s("b-card-body",{staticClass:"pt-0 pb-3"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-sm pt-3"},[s("b-pagination",{attrs:{"total-rows":e.pageData.totalItems,"per-page":e.pageData.perPage},on:{change:e.pageChanged},model:{value:e.pageData.currentPage,callback:function(t){e.$set(e.pageData,"currentPage",t)},expression:"pageData.currentPage"}})],1),e._v(" "),s("div",{staticClass:"col-sm text-sm-left text-center pt-3"},[e.pageData.totalItems?s("span",{staticClass:"text-muted"},[e._v("Trang "+e._s(e.pageData.currentPage)+" trên "+e._s(e.pageData.totalPages))]):e._e()])])])],1)]):e._e(),e._v(" "),0==e.listShops.length?s("div",{staticClass:"no-data"},[s("b-alert",{attrs:{show:"",dismissible:"",variant:"warning"}},[s("i",{staticClass:"sidenav-icon ion ion-ios-warning"}),e._v("\n                    Không có dữ liệu phù hợp, vui lòng thử lại.\n                ")])],1):e._e()],1):e._e(),e._v(" "),s("loading-mini-bottom",{attrs:{enable:e.appLoading}}),e._v(" "),e.loadingTransfer?s("BlockUI",{attrs:{message:"Dữ liệu đang được xử lý, vui lòng đợi!",html:e.htmlTransfer}}):e._e()],1)])},[],!1,C,"data-v-a07bad82",null);t.default=D.exports},"yt+X":function(e,t){}});