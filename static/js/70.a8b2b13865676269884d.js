webpackJsonp([70],{"4Xhn":function(e,a){},DT6O:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t("RUzx"),l=t.n(s),r=t("hC/b"),n=t("TpM6"),o=t("Bo22"),c=t.n(o),i=t("PJh5"),h=t.n(i),u={name:"export-salary",components:{Multiselect:l.a,commonHelper:r.a,CustomerCareService:n.a,VueMonthlyPicker:c.a,Moment:h.a},props:[],data:function(){return{filter:null,isBusy:!1,users:[],customerCares:[],salaryData:[],runSuccessCust:0,countCustomerCare:0,minMonth:new h.a("2019-10"),maxMonth:(new h.a).format("YYYY-MM"),salaryMonth:new h.a,types:[{id:1,name:"Tất cả"},{id:2,name:"Leader"},{id:3,name:"CSKH"}],type:{id:1,name:"Tất cả"},paginConfig:{per_page:5,current_page:1,total_row:0},fields:[{key:"user_id",label:"User ID",sortable:!0},{key:"staff_code",label:"Mã nhân viên",sortable:!0},{key:"station_id",label:"ID kho",sortable:!0},{key:"station_name",label:"Kho",sortable:!0},{key:"full_name",label:"Họ tên",sortable:!0},{key:"user_name",label:"Tên đăng nhập",sortable:!0},{key:"group_name",label:"Nhóm tài khoản",sortable:!0},{key:"ranking",label:"Cấp bậc",sortable:!0},{key:"manager_level",label:"Cấp bậc quản lý",sortable:!0},{key:"position_name",label:"Vị trí",sortable:!0},{key:"region",label:"Miền",sortable:!0},{key:"join_date",label:"Ngày vào chính thức",sortable:!0},{key:"work_shift_count_kpi_sunday",label:"Công chuẩn",sortable:!0},{key:"emp_work_shift",label:"Công chính thức",sortable:!0},{key:"prob_work_shift",label:"Công thử việc",sortable:!0},{key:"emp_ot_work_shift",label:"Công tăng ca chính thức",sortable:!0},{key:"prob_ot_work_shift",label:"Công tăng ca thử việc",sortable:!0},{key:"emp_holiday",label:"Công lễ chính thức",sortable:!0},{key:"prob_holiday",label:"Công lễ thử việc",sortable:!0},{key:"leave_has_salary",label:"Nghỉ phép",sortable:!0},{key:"total_shop",label:"Số shop",sortable:!0},{key:"total_quantity_pkg",label:"Số đơn hàng thành công",sortable:!0},{key:"return_percent",label:"Tỷ lệ hoàn",sortable:!0},{key:"satisfied_percent",label:"Tỷ lệ hài lòng",sortable:!0},{key:"change_return_percent",label:"Tỷ lệ thay đổi tỷ lệ hoàn",sortable:!0},{key:"minimum_salary",label:"Lương đảm bảo",sortable:!0},{key:"prob_salary",label:"Lương thử việc",sortable:!0},{key:"emp_ot_salary",label:"Lương tăng ca chính thức",sortable:!0},{key:"prob_ot_salary",label:"Lương tăng ca thử việc",sortable:!0},{key:"leave_salary",label:"Lương nghỉ phép",sortable:!0},{key:"emp_holiday_salary",label:"Lương lễ chính thức",sortable:!0},{key:"prob_holiday_salary",label:"Lương lễ thử việc",sortable:!0},{key:"quantity_salary",label:"Lương sản lượng",sortable:!0},{key:"return_salary",label:"Lương hoàn",sortable:!0},{key:"satisfied_salary",label:"Lương tỷ lệ hài lòng",sortable:!0},{key:"change_percent_return_salary",label:"Lương tỷ lệ thay đổi tỷ lệ hoàn",sortable:!0},{key:"allowance_manager",label:"Phụ cấp quản lý",sortable:!0},{key:"total_salary",label:"Tổng lương",sortable:!0}]}},created:function(){this.getCustomterCares()},mounted:function(){},watch:{type:function(e,a){this.users=this.customerCares=[],this.salaryData=[],1===e.id?this.getCustomterCares():2===e.id?this.getCustomerCareLeader():this.getCustomerCareMember()}},computed:{},methods:{getCustomterCares:function(){var e=this;n.a.getCustomerCares().then(function(a){a.data.success?(e.users=a.data.data,e.countCustomerCare=a.data.count,r.a.showMessage(a.data.message,"success")):r.a.showMessage(a.data.message,"warning")}).catch(function(e){console.log(e)})},customRecord:function(e){var a=e.ErpUser,t=e.ErpStation,s=e.ErpAddress;return a.username+" - "+t.name+" - "+s.name},getCustomerCareLeader:function(){var e=this;n.a.getAllLeaderCustomerCareB2C().then(function(a){a.data.success?(e.users=a.data.data,e.countCustomerCare=a.data.count,r.a.showMessage(a.data.message,"success")):r.a.showMessage(a.data.message,"warning")}).catch(function(e){console.log(e)})},getCustomerCareMember:function(){var e=this;n.a.getAllMemberCustomerCareB2C().then(function(a){a.data.success?(e.users=a.data.data,e.countCustomerCare=a.data.count,r.a.showMessage(a.data.message,"success")):r.a.showMessage(a.data.message,"warning")}).catch(function(e){console.log(e)})},createDataSalary:function(){var e=this;this.runSuccessCust=0;var a=this.users;this.times=this.salaryMonth.format("YYYY-MM").split("-"),this.customerCares.length>0&&(a=this.customerCares),this.countCustomerCare=a.length,a.forEach(function(a){var t={type:e.type.id,month:e.times[1],year:e.times[0],user:a};n.a.createDataSalaryCustomerCareB2C(t).then(function(a){a.data.success?(e.runSuccessCust+=1,r.a.showMessage(a.data.message,"success")):r.a.showMessage(a.data.message,"warning")}).catch(function(e){console.log(e)})})},onFiltered:function(e){this.paginConfig.total_row=e.length,this.paginConfig.current_page=1},showSalary:function(){var e=this,a=this.users;this.times=this.salaryMonth.format("YYYY-MM").split("-"),this.customerCares.length>0&&(a=this.customerCares);var t={type:this.type.id,month:this.times[1],year:this.times[0],users:a};n.a.showCustomerCareB2CSalary(t).then(function(a){a.data.success?(e.salaryData=a.data.data,e.paginConfig.total_row=a.data.count,r.a.showMessage(a.data.message,"success")):r.a.showMessage(a.data.message,"warning")}).catch(function(e){console.log(e)})},exportToExcel:function(){if(1!==this.type.id)if(this.salaryData.length<1)r.a.showMessage("Không có dữ liệu lương, Hãy show lương trước lúc xuất excel!","warning");else{this.times=this.salaryMonth.format("YYYY-MM").split("-");var e={salary_data:this.salaryData,type:this.type.id,month:this.times[1],year:this.times[0]};n.a.exportCustomerCareB2CSalary(e).then(function(e){e.data.success?(r.a.showMessage(e.data.message,"success"),window.location.href=e.data.path):r.a.showMessage(e.data.message,"warning")}).catch(function(e){console.log(e)})}else r.a.showMessage("Không thể xuất dữ liệu lương leader và cskh trong cùng một file!","warning")}}},g=t("XyMi");var m=function(e){t("OEkN"),t("4Xhn")},b=Object(g.a)(u,function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("b-card",{attrs:{"no-body":""}},[t("b-card-body",[t("b-row",[t("b-col",{attrs:{cols:"6"}},[t("h4",{staticClass:"pt-1"},[e._v("Chạy và xuất lương CSKH B2C:")])]),e._v(" "),t("b-col",{attrs:{cols:"6"}},[t("b-row",{staticClass:"pl-3"},[t("h5",{staticClass:"pt-2"},[t("span",{staticClass:"c-red"},[e._v("(*)")]),e._v(" Chọn kỳ lương:  ")]),e._v(" "),t("vue-monthly-picker",{staticClass:"monthly-picker",attrs:{alignment:"center",dateFormat:"MM-YYYY",min:e.minMonth,max:e.maxMonth,clearOption:!0},model:{value:e.salaryMonth,callback:function(a){e.salaryMonth=a},expression:"salaryMonth"}})],1)],1)],1),e._v(" "),t("hr"),e._v(" "),t("b-row",{staticClass:"mb-2"},[t("b-col",{staticClass:"mt-2",attrs:{xl:"2",md:"2"}},[t("multiselect",{attrs:{label:"name","track-by":"name",selectedLabel:"",deselectLabel:"",selectLabel:"Chọn",options:e.types,searchable:!1,"allow-empty":!1},model:{value:e.type,callback:function(a){e.type=a},expression:"type"}})],1),e._v(" "),t("b-col",{staticClass:"mt-2",attrs:{xl:"6",md:"8"}},[t("multiselect",{staticClass:"multiselect-success",attrs:{options:e.users,placeholder:"Chọn CSKH cần chạy lương",selectedLabel:"Đã chọn",deselectLabel:"Bỏ chọn",selectLabel:"Chọn","track-by":"ErpUser",label:"ErpUser",searchable:!0,multiple:!0,"hide-selected":!0,"allow-empty":!0,clearOption:!0,"custom-label":e.customRecord},model:{value:e.customerCares,callback:function(a){e.customerCares=a},expression:"customerCares"}},[t("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Rất tiếc, không tìm thấy!")])]),e._v(" "),t("b-progress",{staticClass:"mt-2",attrs:{value:0==e.countCustomerCare?0:e.runSuccessCust/e.countCustomerCare*100,max:100,variant:"success","show-progress":""}})],1),e._v(" "),t("b-col",{staticClass:"right",attrs:{xl:"4",md:"2"}},[t("b-button",{staticClass:"mt-2 w-130",attrs:{variant:"danger"},on:{click:e.createDataSalary}},[t("i",{staticClass:"ion ion-md-color-wand"}),e._v(" Chạy lương")]),e._v(" "),t("b-button",{staticClass:"mt-2 w-130",attrs:{variant:"success"},on:{click:e.showSalary}},[t("i",{staticClass:"ion ion-ios-eye"}),e._v(" Show lương")]),e._v(" "),t("b-button",{staticClass:"mt-2 w-130",attrs:{variant:"primary"},on:{click:e.exportToExcel}},[t("i",{staticClass:"ion ion-md-cloud-download"}),e._v(" Xuất lương")])],1)],1),e._v(" "),t("hr"),e._v(" "),t("b-row",[t("b-col",{attrs:{cols:"3"}},[t("b-form-input",{staticClass:"search-size",attrs:{size:"sm",placeholder:"Tìm kiếm ..."},model:{value:e.filter,callback:function(a){e.filter=a},expression:"filter"}})],1),e._v(" "),t("b-col",[t("p",[t("b",[e._v("Show lương: "),t("span",{staticClass:"c-red"},[e._v(e._s(e.salaryData.length)+"/"+e._s(e.countCustomerCare))]),e._v(" cskh")])])])],1),e._v(" "),t("br"),e._v(" "),t("div",[t("b-table",{ref:"dataTable",staticClass:"card-table",staticStyle:{"text-align":"center"},attrs:{responsive:"","sticky-header":"",items:e.salaryData,fields:e.fields,striped:!1,bordered:!0,outlined:!0,hover:!0,"per-page":e.paginConfig.per_page,"current-page":e.paginConfig.current_page,filter:e.filter},on:{filtered:e.onFiltered}})],1),e._v(" "),e.paginConfig.total_row>0?t("b-pagination",{staticClass:"mt-2",attrs:{"total-rows":e.paginConfig.total_row,"per-page":e.paginConfig.per_page,align:"center",size:"sm"},model:{value:e.paginConfig.current_page,callback:function(a){e.$set(e.paginConfig,"current_page",a)},expression:"paginConfig.current_page"}}):e._e()],1)],1)},[],!1,m,"data-v-302193f7",null);a.default=b.exports}});