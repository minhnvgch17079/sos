webpackJsonp([78],{USGt:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("QKlT"),i=a.n(o),n=a("qaB4"),s=a("YmGg"),l=a("Bo22"),r=a.n(l),c=a("HveU"),d={name:"export-work-data",metaInfo:{title:"Export Data Work"},components:{flatPickr:i.a,LaddaBtn:n.a,salaryService:s.a,VueMonthlyPicker:r.a,SweetModal:c.a,SweetModalTab:c.b},data:function(){return{one:{typeButton:1,listUrl:[],loading:!1,progress:!1,range:null,alias:"",rangeConfig:{mode:"range",altInput:!0,dateFormat:"Y-m-d",altFormat:"Y-m-d"},urlDownload:""},two:{listAlias:"",selectedMonth:"",loadingButton1:!1,progressValue:0,resultUpdate:{fail:"",success:""},updateMessage:null,typeButton:1,loadingButton2:!1,urlDownload:""}}},methods:{showModal:function(){""!==this.two.listAlias&&""!==this.two.selectedMonth&&!0!==this.two.loadingButton2&&this.$refs.myModalRef.show()},exportAndDowload:function(){var t=this;if(1===this.one.typeButton&&null!==this.one.range){this.one.loading=!0;var e=this.one.range.split(" "),a={alias:this.one.alias,from:e[0],to:e[2]};s.a.exportWorkDataCod(a).then(function(e){e.data.hasOwnProperty("success")&&(t.$notify({group:"notifications-default",type:e.data.success?"":"bg-danger text-white",title:e.data.success?"Thành công":"Lỗi",text:e.data.message}),e.data.success&&(t.one.typeButton=0,t.one.urlDownload=e.data.data,t.one.listUrl.push({STT:t.one.listUrl.length+1,Alias:t.one.alias,Link:t.one.urlDownload})),t.one.loading=!1)}).catch(function(){t.$notify({group:"notifications-default",type:"bg-danger text-white",title:"Lỗi",text:"Đã có lỗi xảy ra."})}).then(function(){t.one.loading=!1})}0===this.one.typeButton&&(window.location.href=this.one.urlDownload)},resetButton:function(){this.one.urlDownload="",this.one.typeButton=1},resetDataSalary:function(){if(""!==this.two.listAlias&&""!==this.two.selectedMonth&&!0!==this.two.loadingButton2){this.resetField(),this.$refs.myModalRef.hide(),this.two.loadingButton1=!0;var t=this.two.selectedMonth._i.toString().split("/"),e=this.monthToRangeWorkDate(t[1],t[0]),a=this.two.listAlias.toString().split(",");this.updateCodSalary(a,e.from,e.to,a.length)}},monthToRangeWorkDate:function(t,e){var a=t>1?t-1:12,o=t>1?e:e-1;return t<10&&(t="0"+t),a<10&&(a="0"+a),{from:o+"-"+a+"-21",to:e+"-"+t+"-20"}},updateCodSalary:function(t,e,a,o){var i=this;if(0!==t.length){var n={alias:t[0].trim(),fr:e,to:a};this.two.updateMessage="Đang chạy dữ liệu cho COD "+n.alias+"...",s.a.updateCodSalary(n).then(function(e){void 0!==e.data.type&&"notAllow"===e.data.type?(i.two.updateMessage="",t=[],i.two.loadingButton1=!1,i.$notify({group:"notifications-default",type:"bg-danger text-white",title:"Lỗi",text:e.data.message})):(e.data.success?i.two.resultUpdate.success+=n.alias+" ":i.two.resultUpdate.fail+=n.alias+" ",i.two.progressValue+=100/o,100===Math.round(i.two.progressValue)&&(i.two.loadingButton1=!1,i.two.updateMessage="",i.$notify({group:"notifications-default",type:"bg-info text-white",title:"Hoàn tất",text:"Đã cập nhật dữ liệu lương cho COD."})))}).catch(function(){i.two.loadingButton1=!1,i.$notify({group:"notifications-default",type:"bg-danger text-white",title:"Lỗi",text:"Đã có lỗi xảy ra."})}).then(function(){t.shift(),i.updateCodSalary(t,e,a,o)})}},resetField:function(){this.two.progressValue=0,this.two.resultUpdate.success="",this.two.resultUpdate.fail="",this.two.updateMessage="",this.two.typeButton=1},exportAndDowload2:function(){var t=this;if(1===this.two.typeButton){if(""===this.two.listAlias||""===this.two.selectedMonth||!0===this.two.loadingButton1)return;this.resetField(),this.two.loadingButton2=!0;var e=this.two.selectedMonth._i.toString().split("/"),a={listAlias:this.two.listAlias.toString().split(","),month:e[1],year:e[0]};s.a.exportSalaryCod(a).then(function(e){e.data.success&&(t.two.urlDownload=e.data.path,t.two.typeButton=0),t.$notify({group:"notifications-default",type:e.data.success?"":"bg-danger text-white",title:e.data.success?"Thành công":"Lỗi",text:e.data.message})}).catch(function(){t.$notify({group:"notifications-default",type:"bg-danger text-white",title:"Lỗi",text:"Đã có lỗi xảy ra."})}).then(function(){t.two.loadingButton2=!1})}0===this.two.typeButton&&(window.location.href=this.two.urlDownload)}}},u=a("XyMi");var h=function(t){a("OEkN")},f=Object(u.a)(d,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._m(0),t._v(" "),a("div",{staticClass:"ui-bordered px-4 pt-4 mb-4"},[a("b-card",{staticClass:"mb-2",attrs:{"no-body":""}},[a("b-card-header",[a("a",{directives:[{name:"b-toggle",rawName:"v-b-toggle.accordion2-1",modifiers:{"accordion2-1":!0}}],staticClass:"d-flex justify-content-between text-dark",attrs:{href:"javascript:void(0)"}},[t._v("\n          Xuất dữ liệu công việc\n          "),a("div",{staticClass:"collapse-icon"})])]),t._v(" "),a("b-collapse",{attrs:{id:"accordion2-1",visible:"",accordion:"accordion2"}},[a("b-card-body",[a("div",{staticClass:"form-row"},[a("div",{staticClass:"col-md mb-6"},[a("label",{staticClass:"form-label"},[t._v("Mã COD")]),t._v(" "),a("b-input",{attrs:{type:"text",placeholder:"Nhập mã COD"},nativeOn:{click:function(e){return t.resetButton(e)}},model:{value:t.one.alias,callback:function(e){t.$set(t.one,"alias",e)},expression:"one.alias"}})],1),t._v(" "),a("div",{staticClass:"col-md mb-4"},[a("label",{staticClass:"form-label"},[t._v("Khoảng thời gian")]),t._v(" "),a("flat-pickr",{attrs:{config:t.one.rangeConfig,placeholder:"Chọn"},nativeOn:{change:function(e){return t.resetButton(e)}},model:{value:t.one.range,callback:function(e){t.$set(t.one,"range",e)},expression:"one.range"}})],1),t._v(" "),a("div",{staticClass:"col-md col-xl-2 mb-4"},[a("label",{staticClass:"form-label d-none d-md-block"},[t._v(" ")]),t._v(" "),a("ladda-btn",{staticClass:"btn btn-info",style:{width:"100%",background:t.one.typeButton?"":"green"},attrs:{loading:t.one.loading,"data-style":"expand-right"},nativeOn:{click:function(e){return t.exportAndDowload(e)}}},[a("span",{class:t.one.typeButton?"ion ion-ios-arrow-forward":"ion ion-ios-arrow-down"}),t._v("\n                  "+t._s(t.one.typeButton?"Xuất dữ liệu":"Tải xuống file")+"\n              ")])],1)])])],1)],1),t._v(" "),a("b-card",{staticClass:"mb-1",attrs:{"no-body":""}},[a("b-card-header",[a("a",{directives:[{name:"b-toggle",rawName:"v-b-toggle.accordion2-2",modifiers:{"accordion2-2":!0}}],staticClass:"d-flex justify-content-between text-dark",attrs:{href:"javascript:void(0)"}},[t._v("\n          Chạy lại lương và xuất dữ liệu lương cho COD\n          "),a("div",{staticClass:"collapse-icon"})])]),t._v(" "),a("b-collapse",{attrs:{id:"accordion2-2",visible:"",accordion:"accordion2"}},[a("b-card-body",[a("div",{staticClass:"form-row"},[a("div",{staticClass:"col-md mb-6"},[a("label",{staticClass:"form-label"},[t._v("Mã COD")]),t._v(" "),a("b-input",{attrs:{type:"text",placeholder:"Nhiều mã COD cách nhau bởi dấu phẩy"},nativeOn:{click:function(e){return t.resetField(e)}},model:{value:t.two.listAlias,callback:function(e){t.$set(t.two,"listAlias",e)},expression:"two.listAlias"}})],1),t._v(" "),a("div",{staticClass:"col-md mb-4"},[a("label",{staticClass:"form-label"},[t._v("Chọn tháng lương")]),t._v(" "),a("vue-monthly-picker",{on:{selected:t.resetField},model:{value:t.two.selectedMonth,callback:function(e){t.$set(t.two,"selectedMonth",e)},expression:"two.selectedMonth"}})],1),t._v(" "),a("div",{staticClass:"col-md col-xl-2 mb-4"},[a("label",{staticClass:"form-label d-none d-md-block"},[t._v(" ")]),t._v(" "),a("ladda-btn",{staticClass:"btn btn-primary",staticStyle:{width:"100%"},attrs:{loading:t.two.loadingButton1,"data-style":"expand-right"},nativeOn:{click:function(e){return t.showModal(e)}}},[t._v("\n                Chạy\n              ")])],1),t._v(" "),a("div",{staticClass:"col-md col-xl-2 mb-4"},[a("label",{staticClass:"form-label d-none d-md-block"},[t._v(" ")]),t._v(" "),a("ladda-btn",{staticClass:"btn btn-info",style:{width:"100%",background:t.two.typeButton?"":"green"},attrs:{loading:t.two.loadingButton2,"data-style":"expand-right"},nativeOn:{click:function(e){return t.exportAndDowload2(e)}}},[a("span",{class:t.two.typeButton?"ion ion-ios-arrow-forward":"ion ion-ios-arrow-down"}),t._v("\n                  "+t._s(t.two.typeButton?"Xuất dữ liệu":"Tải xuống file")+"\n              ")])],1)]),t._v(" "),a("p",{staticStyle:{"font-size":"small"}},[t._v(t._s(t.two.updateMessage))]),t._v(" "),t.two.progressValue?a("b-progress",{attrs:{value:t.two.progressValue,height:"0.25rem"}}):t._e(),t._v(" "),this.two.resultUpdate.success||this.two.resultUpdate.fail?a("div",[a("b",{staticStyle:{"font-size":"small"}},[t._v("Kết quả:")]),t._v(" "),""!==this.two.resultUpdate.success?a("i",{staticClass:"ion d-block ion-md-checkmark",staticStyle:{color:"green","margin-left":"10px"}},[t._v(" "+t._s(this.two.resultUpdate.success))]):t._e(),t._v(" "),""!==this.two.resultUpdate.fail?a("i",{staticClass:"ion d-block ion-md-close",staticStyle:{color:"red","margin-left":"10px"}},[t._v(" "+t._s(this.two.resultUpdate.fail))]):t._e()]):t._e()],1)],1)],1)],1),t._v(" "),a("b-table",{attrs:{striped:"",hover:"",items:t.one.listUrl}}),t._v(" "),a("notifications",{attrs:{group:"notifications-default"}}),t._v(" "),a("b-modal",{ref:"myModalRef",attrs:{"hide-footer":"",static:""}},[a("div",{staticClass:"d-block text-center"},[a("h4",[t._v("Bạn có chắc chắn muốn chạy lại lương cho COD?")])]),t._v(" "),a("b-btn",{staticClass:"mt-3",attrs:{variant:"outline-success",block:""},on:{click:t.resetDataSalary}},[t._v("Xác nhận")])],1)],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{staticClass:"d-flex justify-content-between align-items-center w-100 font-weight-bold py-3 mb-4"},[e("div",[this._v("Xuất file dữ liệu làm việc và lương tháng cho COD")])])}],!1,h,null,null);e.default=f.exports}});