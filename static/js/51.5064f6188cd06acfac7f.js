webpackJsonp([51],{k82V:function(e,t){},t3oW:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("mvHQ"),a=n.n(i),r=n("HveU"),s=n("PikB"),o=function(e){return s.a.get("/executive-team/getAll",{params:e})},c=function(e){return s.a.get("/executive-team/getSelectableMember",{params:e})},l=function(e){return s.a.post("/executive-team/createTeam",e)},u=function(e){return s.a.post("/executive-team/deleteTeam",e)},m=function(e){return s.a.post("/executive-team/updateTeam",e)},d=n("F/2K"),f=n("a/7L"),p=n("RUzx"),h={name:"single-select-executive-team-member",components:{Multiselect:n.n(p).a},props:{memberId:{type:String}},data:function(){return{option:null,options:[]}},created:function(){this.getList()},watch:{memberId:function(e,t){e?this.setList():this.option=null},option:function(e,t){this.$emit("on-select",e)}},methods:{customLabel:function(e){var t=e.fullname,n=e.username;e.stationname;return t+" ("+n+")"},setList:function(){var e=this;this.memberId&&(this.option=this.options.find(function(t){return t.id===e.memberId}))},getList:function(){var e=this;c().then(function(t){t.data.success&&(e.options=t.data.data,e.setList())}).catch(function(e){console.log(e)})}}},v=n("XyMi"),b=Object(v.a)(h,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("multiselect",{staticClass:"multiselect-primary",attrs:{options:e.options,placeholder:"Chọn nhân sự","custom-label":e.customLabel,"track-by":"username",selectedLabel:"Đã chọn",deselectLabel:"Bỏ chọn",selectLabel:"Chọn",searchable:!0},model:{value:e.option,callback:function(t){e.option=t},expression:"option"}},[n("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Rất tiếc. Không tìm thấy.")])])],1)},[],!1,null,null,null).exports,_=n("hC/b"),g=n("TyzE"),M=n("3BrW"),y={name:"modal-create-executive-team",components:{SingleSelectProvince:d.a,MultiSelectProvince:g.a,MultiSelectStation:M.a,SingleSelectExecutiveTeamMember:b,SweetModal:r.a},props:{trigger:{type:Boolean}},data:function(){return{team:{province_id:null,station_id:null,member_id:null}}},watch:{trigger:function(e,t){this.team.province_id=null,this.team.station_id=null,this.team.member_id=null,this.$refs["modal-create"].show()}},computed:{provinceIds:function(){return this.team.province_id?this.team.province_id.join(","):""}},methods:{showSuccessModal:function(){var e=this;this.$refs.successModal.open(),setTimeout(function(){e.$refs.successModal.close()},1200)},setProvince:function(e){this.team.province_id=e?e.map(function(e){return e.id}):null},setStation:function(e){this.team.station_id=e?e.map(function(e){return e.id}):null},setLeader:function(e){this.team.leader_id=e?e.id:null},setMember:function(e){this.team.member_id=e?e.id:null},createTeam:function(){var e=this;l(this.team).then(function(t){t.data.success?(e.$emit("on-created"),e.$refs["modal-create"].hide(),e.$refs.successModal.open(),setTimeout(function(){e.$refs.successModal.close()},1200)):_.a.showMessage(t.data.message,"fail")})}}};var S=function(e){n("u2bN")},k=Object(v.a)(y,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-modal",{ref:"modal-create",attrs:{title:"Thêm cơ cấu keyperson",static:"",centered:""},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[n("div",{staticClass:"text-center w-100"},[n("b-btn",{attrs:{variant:"primary"},on:{click:e.createTeam}},[e._v("Thêm")])],1)]},proxy:!0}])},[n("b-form-group",{attrs:{label:"Chọn thành viên"}},[n("single-select-executive-team-member",{attrs:{"member-id":e.team.member_id},on:{"on-select":e.setMember}})],1),e._v(" "),n("b-form-group",{attrs:{label:"Chọn tỉnh quản lý"}},[n("multi-select-province",{attrs:{"province-id":e.team.province_id,"limit-prop":9999},on:{handleProvinceSelected:e.setProvince}})],1),e._v(" "),n("b-form-group",{attrs:{label:"Chọn kho quản lý"}},[n("multi-select-station",{attrs:{"province-ids":e.provinceIds,"auto-close":!1,"limit-prop":9999},on:{handleStationSelected:e.setStation}})],1)],1),e._v(" "),n("sweet-modal",{ref:"successModal",attrs:{icon:"success"}},[n("b",[e._v("Thêm keyperson thành công")])])],1)},[],!1,S,null,null).exports,x={name:"executive-team-manage",components:{SingleSelectProvince:d.a,SingleSelectStation:f.a,SingleSelectExecutiveTeamMember:b,ModalCreateExecutiveTeam:k,SweetModal:r.a},data:function(){return{alertMessage:"",triggerCreateModal:!1,total:0,filter:{province_id:null,station_id:null,pattern:null,currentPage:1,perPage:10},tblFilter:{province_id:null,station_id:null,pattern:null,currentPage:1,perPage:10},fields:[{key:"id",label:"ID"},{key:"province",label:"Tỉnh"},{key:"station",label:"Kho"},{key:"member",label:"Tên member"},{key:"action",label:"Chỉnh sửa",thStyle:"width: 200px"}]}},created:function(){},methods:{setNewMem:function(e,t){e.new_mem_id=t.id},setProvince:function(e){this.filter.province_id=e?e.id:null},setStation:function(e){this.filter.station_id=e?e.id:null},search:function(){this.filter.currentPage=1,this.applyFilter()},updateTable:function(){this.$refs["f-table"].refresh()},applyFilter:function(){this.tblFilter=JSON.parse(a()(this.filter))},teamProvider:function(e){var t=this;return o(e.filter).then(function(e){if(e.data.success){t.total=parseInt(e.data.total);var n=e.data.data;return n?(n.forEach(function(e){e.new_mem_id=e.member_id}),n):[]}})},openModalCreate:function(){this.triggerCreateModal=!this.triggerCreateModal},deleteTeam:function(e){var t=this;u({id:e.id,station_id:e.station_id}).then(function(e){e.data.success&&(t.updateTable(),t.alertMessage="Xóa cơ cấu thành công",t.$refs.successModal.open(),setTimeout(function(){t.$refs.successModal.close()},1200))})},updateTeam:function(e){var t=this,n={id:e.id,station_id:e.station_id,member_id:e.new_mem_id};m(n).then(function(e){e.data.success&&(t.updateTable(),t.alertMessage="Cập nhật thành công",t.$refs.successModal.open(),setTimeout(function(){t.$refs.successModal.close()},1200))})}}};var T=function(e){n("k82V")},C=Object(v.a)(x,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-card",[n("h4",{staticClass:"ui-block-heading",staticStyle:{margin:"0px",display:"inline-block"}},[e._v("Cơ cấu keyperson")]),e._v(" "),n("hr"),e._v(" "),n("b-row",{staticClass:"mb-2"},[n("b-col",{staticClass:"text-left"},[n("b-row",[n("b-col",[n("b-form-input",{attrs:{placeholder:"Nhập tên thành viên nhóm"},model:{value:e.filter.pattern,callback:function(t){e.$set(e.filter,"pattern",t)},expression:"filter.pattern"}})],1),e._v(" "),n("b-col",[n("single-select-province",{on:{handleSelectedProvince:e.setProvince}})],1),e._v(" "),n("b-col",[n("single-select-station",{attrs:{"province-id":e.filter.province_id},on:{handleSelectedStation:e.setStation}})],1),e._v(" "),n("b-col",[n("b-btn",{attrs:{variant:"primary"},on:{click:e.search}},[n("i",{staticClass:"ion ion-ios-search"}),e._v(" Tìm kiếm")])],1)],1)],1),e._v(" "),n("b-col",{staticClass:"text-right"},[n("b-btn",{attrs:{variant:"primary"},on:{click:e.openModalCreate}},[e._v("+ Tạo mới")])],1)],1),e._v(" "),n("b-table",{ref:"f-table",attrs:{filter:e.tblFilter,fields:e.fields,items:e.teamProvider},scopedSlots:e._u([{key:"cell(station)",fn:function(t){return[e._v("\n        "+e._s(t.item.station_name)+"\n      ")]}},{key:"cell(province)",fn:function(t){return[e._v("\n        "+e._s(t.item.province_name)+"\n      ")]}},{key:"cell(member)",fn:function(t){return[n("single-select-executive-team-member",{attrs:{"member-id":t.item.member_id},on:{"on-select":function(n){for(var i=arguments.length,a=Array(i);i--;)a[i]=arguments[i];return e.setNewMem.apply(void 0,[t.item].concat(a))}}})]}},{key:"cell(action)",fn:function(t){return[n("div",{staticClass:"text-right"},[n("b-btn",{directives:[{name:"show",rawName:"v-show",value:t.item.new_mem_id!==t.item.member_id,expression:"data.item.new_mem_id !== data.item.member_id"}],staticClass:"action-btn",attrs:{variant:"primary"},on:{click:function(n){return e.updateTeam(t.item)}}},[e._v(" Lưu")]),e._v(" "),n("b-btn",{staticClass:"action-btn",attrs:{variant:"danger"},on:{click:function(n){return e.deleteTeam(t.item)}}},[e._v(" Xóa")])],1)]}},{key:"table-caption",fn:function(){return[n("b-pagination",{attrs:{"per-page":e.filter.perPage,"total-rows":e.total,align:"center"},on:{input:e.applyFilter},model:{value:e.filter.currentPage,callback:function(t){e.$set(e.filter,"currentPage",t)},expression:"filter.currentPage"}})]},proxy:!0}])})],1),e._v(" "),n("modal-create-executive-team",{attrs:{trigger:e.triggerCreateModal},on:{"on-created":e.updateTable}}),e._v(" "),n("sweet-modal",{ref:"successModal",attrs:{icon:"success"}},[n("b",[e._v(e._s(e.alertMessage))])])],1)},[],!1,T,"data-v-f7eb0074",null);t.default=C.exports}});