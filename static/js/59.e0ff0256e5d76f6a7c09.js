webpackJsonp([59],{"3QQ8":function(t,e){},wMlS:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("xF2Z"),s=n("9fS5"),i=n("a/7L"),r=n("YlZe"),o=n("csCE"),l={name:"master-profile-manager",components:{SkRotatingPlane:s.a,SingleSelectStation:i.a,SingleSelectPosition:r.a,SingleSelectDepartment:o.a},data:function(){return{username:"",cmnd:"",stationId:"",departmentId:"",positionId:"",users:[],usersSelected:[],mainProfileSelected:null,uncheckUser:!1,appLoading:!1,firstTime:!0,currentPage:1,totalItems:0,perPage:5}},computed:{totalPages:function(){return Math.ceil(this.totalItems/this.perPage)}},watch:{usersSelected:function(t,e){var n=this;0===t.filter(function(t){return function(t){return t.id===n.mainProfileSelected}(t)}).length&&(this.mainProfileSelected=null)}},methods:{search:function(){var t=this;if(this.validate()){this.appLoading=!0;var e={cmnd:this.cmnd,username:this.username,stationId:this.stationId,departmentId:this.departmentId,positionId:this.positionId,page:this.currentPage,limit:this.perPage};a.a.getUserList(e).then(function(e){e.data.success&&(t.users=e.data.data.data,t.totalItems=e.data.data.total)}).catch(function(t){console.log(t)}).then(function(){t.appLoading=!1}),this.firstTime=!1}else this.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo lỗi",text:"CMND phải nhập đủ hoặc username phải nhập ít nhất 3 kí tự"})},handleSelectedStation:function(t){this.stationId=t?t.id:""},handleSelectedDepartment:function(t){this.departmentId=t?t.id:""},handleSelectedPosition:function(t){this.positionId=t?t.id:""},validate:function(){var t=0===this.cmnd.length||9===this.cmnd.length||12===this.cmnd.length,e=0===this.username.length||this.username.length>=3;return!(!t||!e)},updateMasterProfile:function(t){var e=this,n={userIds:this.usersSelected.map(function(t){return t.userId}),mainProfileId:this.mainProfileSelected};a.a.updateMainProfile(n).then(function(t){t.data.success?e.$notify({group:"default",type:"bg-success text-white",title:"Thông báo thành công",text:"Đã xác nhận profile chính thành công"}):e.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo lỗi",text:t.data.message})}).catch(function(t){console.log(t)})}},created:function(){}},c=n("XyMi");var d=function(t){n("3QQ8")},h=Object(c.a)(l,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"update-master-profile"},[n("div",{staticClass:"ui-block"},[n("h4",{staticClass:"ui-block-heading"},[t._v("Cập nhật profile chính của nhân viên")]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"mb-3"},[n("b-row",[n("b-col",{attrs:{md:"2"}},[n("b-input",{attrs:{placeholder:"CMND/Hộ chiếu",type:"number",min:"9",max:"12"},model:{value:t.cmnd,callback:function(e){t.cmnd=e},expression:"cmnd"}})],1),t._v(" "),n("b-col",{attrs:{md:"2"}},[n("b-input",{attrs:{type:"text",placeholder:"Nhập thông tin user"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1),t._v(" "),n("b-col",[n("single-select-station",{on:{handleSelectedStation:t.handleSelectedStation}})],1),t._v(" "),n("b-col",[n("single-select-department",{on:{handleSelectedDepartment:t.handleSelectedDepartment}})],1),t._v(" "),n("b-col",[n("single-select-position",{attrs:{"department-id":t.departmentId},on:{handleSelectedPosition:t.handleSelectedPosition}})],1),t._v(" "),n("b-col",[n("b-btn",{attrs:{type:"button",variant:"primary"},on:{click:function(e){t.currentPage=1,t.search()}}},[n("i",{staticClass:"sidenav-icon ion ion-md-search"}),t._v(" Tìm kiếm")])],1)],1)],1),t._v(" "),n("div",{staticClass:"mb-3"},[n("h6",{staticClass:"mb-1"},[t._v("1. Tìm kiếm các tài khoản của User")]),t._v(" "),n("div",{staticClass:"pl-3"},[t.users.length>0?n("b-card",{attrs:{"no-body":""}},[n("table",{staticClass:"table mb-0 table-bordered"},[n("thead",[n("tr",[n("th",[t._v("STT")]),t._v(" "),n("th",[t._v("username")]),t._v(" "),n("th",[t._v("fullname")]),t._v(" "),n("th",[t._v("CMND")]),t._v(" "),n("th",[t._v("Vị trí")]),t._v(" "),n("th",[t._v("Loại hình làm việc")]),t._v(" "),n("th",[t._v("Kho")]),t._v(" "),n("th",[t._v("Chọn profile")])])]),t._v(" "),n("tbody",t._l(t.users,function(e,a){return n("tr",[n("td",[t._v(t._s(a+1))]),t._v(" "),n("td",[t._v(t._s(e.username))]),t._v(" "),n("td",[t._v(t._s(e.fullname))]),t._v(" "),n("td",[t._v(t._s(e.cmnd))]),t._v(" "),n("td",[t._v(t._s(e.positionName))]),t._v(" "),n("td",[t._v(t._s(e.work_type_description))]),t._v(" "),n("td",[t._v(t._s(e.stationName))]),t._v(" "),n("td",[n("b-form-group",[n("b-form-checkbox-group",{model:{value:t.usersSelected,callback:function(e){t.usersSelected=e},expression:"usersSelected"}},[n("b-form-checkbox",{attrs:{value:e}})],1)],1)],1)])}),0)]),t._v(" "),t.totalPages>1?n("div",{staticClass:"mt-3"},[n("b-row",[n("b-col",{attrs:{md:"6"}},[n("b-pagination",{attrs:{"total-rows":t.totalItems,"per-page":t.perPage},on:{input:t.search},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),t._v(" "),n("b-col",{attrs:{md:"6"}},[n("span",{staticClass:"text-muted"},[t._v("Trang "+t._s(t.currentPage)+" trên "+t._s(t.totalPages))])])],1)],1):t._e()]):t._e(),t._v(" "),!1===t.appLoading&&0===t.users.length&&!1===t.firstTime?n("div",[n("span",{staticClass:"pl-3 font-weight-bold"},[t._v("Rất tiếc, không tìm thấy user phù hợp.")])]):t._e()],1)]),t._v(" "),n("div",[n("h6",{staticClass:"mb-1"},[t._v("2. Chọn profile chính")]),t._v(" "),n("div",{staticClass:"pl-3"},[t.usersSelected.length>0?n("b-card",{attrs:{"no-body":""}},[n("table",{staticClass:"table mb-0 table-bordered"},[n("thead",[n("tr",[n("th",[t._v("STT")]),t._v(" "),n("th",[t._v("username")]),t._v(" "),n("th",[t._v("fullname")]),t._v(" "),n("th",[t._v("CMND")]),t._v(" "),n("th",[t._v("Vị trí")]),t._v(" "),n("th",[t._v("Loại hình làm việc")]),t._v(" "),n("th",[t._v("Kho")]),t._v(" "),n("th",[t._v("Chọn profile")]),t._v(" "),n("th",[t._v("Chọn profile chính")])])]),t._v(" "),n("tbody",t._l(t.usersSelected,function(e,a){return n("tr",[n("td",[t._v(t._s(a+1))]),t._v(" "),n("td",[t._v(t._s(e.username))]),t._v(" "),n("td",[t._v(t._s(e.fullname))]),t._v(" "),n("td",[t._v(t._s(e.cmnd))]),t._v(" "),n("td",[t._v(t._s(e.positionName))]),t._v(" "),n("td",[t._v(t._s(e.work_type_description))]),t._v(" "),n("td",[t._v(t._s(e.stationName))]),t._v(" "),n("td",[n("b-form-group",[n("b-form-checkbox-group",{model:{value:t.usersSelected,callback:function(e){t.usersSelected=e},expression:"usersSelected"}},[n("b-form-checkbox",{attrs:{value:e}})],1)],1)],1),t._v(" "),n("td",[n("b-form-group",[n("b-form-radio-group",{model:{value:t.mainProfileSelected,callback:function(e){t.mainProfileSelected=e},expression:"mainProfileSelected"}},[n("b-form-radio",{attrs:{value:e.profileId}})],1)],1)],1)])}),0)]),t._v(" "),n("b-row",{staticClass:"mt-3 mb-3"},[n("b-col",{attrs:{md:"2","offset-md":"10"}},[n("b-btn",{staticClass:"btn btn-outline-primary",on:{click:t.updateMasterProfile}},[t._v("Xác nhận")])],1)],1)],1):t._e()],1),t._v(" "),t.firstTime?n("div"):t._e(),t._v(" "),t.appLoading?n("sk-rotating-plane"):t._e()],1)])])},[],!1,d,"data-v-bf849e5e",null);e.default=h.exports}});