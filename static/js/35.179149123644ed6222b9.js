webpackJsonp([35],{"2nLn":function(t,e){},E4hU:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("PikB"),a=function(t){return n.a.get("/position/getPositionLeader",{params:t})},s=function(t){return n.a.delete("/position/deletePositionLeader",{params:t})},o=function(t){return n.a.post("/position/updatePositionLeader",t)},d=function(){return n.a.get("/position/getAllLeader")},l=function(t){return n.a.get("/position/getPositionConfigById",{params:t})},r=i("YlZe"),c=i("csCE"),h=i("Gu7T"),p=i.n(h),u=i("RUzx"),m=i.n(u),f={name:"multi-select-leader",props:{limitProp:{},leaderIds:{},autoClose:{},hideSelected:{},displayAll:{},isDisabled:{default:!1}},components:{Multiselect:m.a},data:function(){return{leaderOption:null,hideSelect:!1,leaderOptions:[],autoClosed:!0,limit:1}},created:function(){this.getAllLeader(),this.limitProp&&(this.limit=this.limitProp),void 0!==this.autoClose&&null!==this.autoClose&&(this.autoClosed=this.autoClose),void 0!==this.hideSelected&&null!==this.hideSelected&&(this.hideSelect=this.hideSelected),void 0!==this.isDisable&&null!==this.isDisable&&(this.disabled=this.isDisable)},watch:{hideSelected:function(t,e){this.hideSelect=this.hideSelected},autoClose:function(t,e){this.autoClosed=this.autoClose},leaderOption:function(t,e){this.displayAll?this.$emit("handleLeaderSelected",t):!0===(t&&-1===t.id||t&&t.length>1&&-1!==t.findIndex(function(t){return-1===t.id}))?this.$emit("handleLeaderSelected",this.leaderOptions):this.$emit("handleLeaderSelected",t)},limitProp:function(t,e){this.limit=t},leaderIds:function(t,e){t?this.leaderOptions&&this.leaderOptions.length>0&&this.setList():this.leaderOption=null}},methods:{setList:function(){var t=this;this.leaderIds&&(this.leaderOption=[],this.leaderIds.split(",").forEach(function(e){t.leaderOption.push(t.leaderOptions.find(function(t){return""+t.id===e}))}))},getAllLeader:function(){var t=this;d().then(function(e){e.data.success&&(t.displayAll?(t.leaderOptions=e.data.data,t.setList()):(t.leaderOptions=[{id:-1,name:"..."}].concat(p()(e.data.data)),t.leaderOptions=t.leaderOptions[0],t.setList()))}).catch(function(t){console.log(t)})},handleInput:function(t){if(!this.displayAll)if(t.findIndex(function(t){return-1===t.id})===t.length-1)this.leaderOption={id:-1,name:"..."};else{var e=t.filter(function(t){return-1!==t.id});this.leaderOption=e}},customLabel:function(t){return t.fullname+" ("+t.username+")"}}},g=i("XyMi");var b=function(t){i("2nLn")},v=Object(g.a)(f,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("multiselect",{staticClass:"multiselect-primary",attrs:{options:t.leaderOptions,multiple:!0,limit:t.limit,placeholder:"Chọn leader",label:"fullname","custom-label":t.customLabel,"track-by":"fullname",selectedLabel:"Đã chọn",deselectLabel:"Nhấn để bỏ chọn leader",selectLabel:"Nhấn enter để chọn","close-on-select":t.autoClosed,"hide-selected":t.hideSelect,disabled:t.isDisabled},on:{input:function(e){return t.handleInput(t.leaderOption)}},model:{value:t.leaderOption,callback:function(e){t.leaderOption=e},expression:"leaderOption"}},[i("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Rất tiếc. Không tìm thấy.")])])],1)},[],!1,b,"data-v-5e2d1a78",null).exports,_=i("fZjL"),L=i.n(_),P=i("xF2Z"),S={name:"single-select-position",components:{Multiselect:m.a},props:{isDisabled:{type:Boolean},departmentName:{},departmentId:{},positionId:{},positionName:{}},data:function(){return{option:null,options:[]}},created:function(){this.getList()},watch:{departmentName:function(t,e){this.option=null,this.options=[],this.getPositionListByDepartment(t)},departmentId:function(t,e){this.option=null,this.options=[],this.getPositionListByDepartment(t)},option:function(t,e){this.$emit("handleSelectedPosition",t)},positionId:function(t,e){t&&this.setSelectedOption()},positionName:function(t,e){t&&this.setSelectedOption()}},methods:{setSelectedOption:function(){var t=this;this.options.length>0&&this.positionId&&(this.option=this.options.find(function(e){return e.id===t.positionId})),this.options.length>0&&this.positionName&&(this.option=this.options.find(function(e){return e.name===t.positionName}))},getList:function(){var t=this;P.a.getPositionList().then(function(e){e.data.success&&(t.options=e.data.data)}).catch(function(t){console.log(t)})},getPositionListByDepartment:function(t){var e=this,i={department:t};P.a.getPositionListByDepartment(i).then(function(t){t.data.success&&(e.options=t.data.data,e.setSelectedOption())}).catch(function(t){console.log(t)})}}},I=Object(g.a)(S,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("multiselect",{attrs:{options:t.options,placeholder:"Chọn vị trí làm việc",label:"name","track-by":"name",selectedLabel:"Đã chọn",deselectLabel:"Bỏ chọn",selectLabel:"Chọn",searchable:!0,disabled:t.isDisabled},model:{value:t.option,callback:function(e){t.option=e},expression:"option"}},[i("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Rất tiếc. Không tìm thấy.")])])],1)},[],!1,null,null,null).exports,y={name:"single-select-department",components:{Multiselect:m.a},props:{departmentName:{},departmentId:{},isDisabled:{type:Boolean}},data:function(){return{option:null,options:[],readonly:!1}},created:function(){this.getList()},watch:{option:function(t,e){this.$emit("handleSelectedDepartment",t)},departmentName:function(t,e){t?this.setSelectedOption():this.option=null},departmentId:function(t,e){t&&this.setSelectedOption(),null!=t&&""!==t||(this.option=null)}},methods:{getList:function(){var t=this;P.a.getDepartmentList().then(function(e){e.data.success&&(t.options=e.data.data,t.setSelectedOption())}).catch(function(t){console.log(t)})},setSelectedOption:function(){var t=this;this.options.length>0&&this.departmentName&&(this.option=this.options.find(function(e){return e.name===t.departmentName})),this.options.length>0&&this.departmentId&&(this.option=this.options.find(function(e){return parseInt(e.id)===parseInt(t.departmentId)}))}}},C=Object(g.a)(y,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("multiselect",{attrs:{options:t.options,placeholder:"Chọn bộ phận",label:"name","track-by":"name",selectedLabel:"Đã chọn",deselectLabel:"Bỏ chọn",selectLabel:"Chọn",searchable:!0,disabled:t.isDisabled},model:{value:t.option,callback:function(e){t.option=e},expression:"option"}},[i("span",{attrs:{slot:"noResult"},slot:"noResult"},[t._v("Rất tiếc. Không tìm thấy.")])])],1)},[],!1,null,null,null).exports,E=i("hC/b"),O={name:"modal-edit-position-leader",components:{SingleSelectPosition:I,SingleSelectDepartment:C,SelectPositionLeader:v},props:["currEditing","trigger","type"],data:function(){return{title:"",dataSavePositionLeader:{position_id:null,leader_id:null},getPositionLeader:null,departmentId:null,positionId:null,leaderId:null,disable:!1}},watch:{currEditing:function(t,e){},trigger:function(t,e){var i=this;if("create"===this.type)this.resetForm();else{if(!this.currEditing)return;var n={id:this.currEditing};l(n).then(function(t){if(t.data.success){i.getPositionLeader=t.data.data,i.departmentId=i.getPositionLeader.ErpEmpPosition.department_id,i.positionId=i.getPositionLeader.ErpEmpPosition.id;var e="";i.getPositionLeader.ErpEmpPosition.leaders.forEach(function(t){e+=t.id+","}),i.leaderId=e.slice(0,-1)}else E.a.showMessage(t.data.message,"warning")}).catch(function(t){console.log(t)}).then(function(){i.appLoading=!1})}this.$refs["edit-modal"].show()},type:function(t,e){"create"===t&&(this.disable=!1,this.title="Tạo config leader cho bộ phận"),"edit"===t&&(this.title="Chỉnh sửa config leader cho bộ phận",this.disable=!0)},positionId:function(t,e){var i=this;"edit"!==this.type&&(""!==this.positionId&&null!=this.positionId?"create"===this.type&&l({id:t}).then(function(t){if(t.data.success){i.getPositionLeader=t.data.data;var e="";i.getPositionLeader.ErpEmpPosition.leaders.forEach(function(t){e+=t.id+","}),i.leaderId=e.slice(0,-1)}else E.a.showMessage(t.data.message,"warning")}).catch(function(t){console.log(t)}).then(function(){i.appLoading=!1}):this.leaderId=null)}},methods:{resetForm:function(){this.leaderId=null,this.departmentId=null,this.dataUpdatePositionLeader=null,this.getPositionLeader=null},handleLeaderSelected:function(t){this.leaderId=t?t.map(function(t){return t.id}).toString():""},handleSelectedDepartment:function(t){this.departmentId=t?t.id:""},handleSelectedPosition:function(t){this.positionId=t?t.id:null},updatePositionLeader:function(){var t=this;this.positionId?this.dataSavePositionLeader.position_id=this.positionId:this.dataSavePositionLeader.position_id=this.currEditing,this.leaderId?this.dataSavePositionLeader.leader_id=this.leaderId:this.dataSavePositionLeader.leader_id=null;var e=new FormData;L()(this.dataSavePositionLeader).forEach(function(i){t.dataSavePositionLeader[i]?e.append(i,t.dataSavePositionLeader[i]):e.append(i,"")}),o(e).then(function(e){e.data.success?(t.$emit("on-updated",e.data.success),t.$refs["edit-modal"].hide()):E.a.showMessage(e.data.message,"fail")})}}};var w=function(t){i("lK0I")},x=Object(g.a)(O,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b-modal",{ref:"edit-modal",attrs:{title:t.title,size:"lg","ok-only":"",static:"",centered:""}},[i("b-row",{staticClass:"mb-3"},[i("b-col",{attrs:{md:"6"}},[i("b-form-group",{attrs:{label:"Phòng ban"}},[i("single-select-department",{attrs:{"department-id":t.departmentId,"is-disabled":t.disable},on:{handleSelectedDepartment:t.handleSelectedDepartment}})],1)],1),t._v(" "),i("b-col",{attrs:{md:"6"}},[i("b-form-group",{attrs:{label:"Vị trí"}},[i("single-select-position",{attrs:{"department-id":t.departmentId,"position-id":t.positionId,"is-disabled":t.disable},on:{handleSelectedPosition:t.handleSelectedPosition}})],1)],1)],1),t._v(" "),i("b-row",{staticClass:"mb-3"},[i("b-col",{attrs:{md:"12"}},[i("b-form-group",{attrs:{label:"Leader"}},[i("select-position-leader",{attrs:{"display-all":!0,"leader-ids":t.leaderId,"limit-prop":99999,"auto-close":!1,"hide-selected":!0},on:{handleLeaderSelected:t.handleLeaderSelected}})],1)],1)],1),t._v(" "),i("template",{slot:"modal-footer"},[i("b-button",{attrs:{variant:"primary"},on:{click:function(e){return t.updatePositionLeader()}}},[t._v("\n        Đồng ý\n        ")])],1)],2)],1)},[],!1,w,"data-v-a542f458",null).exports,k={name:"position-manager",components:{SingleSelectPosition:r.a,SingleSelectDepartment:c.a,SelectPositionLeader:v,ModalEditPositionLeader:x},data:function(){return{departmentId:"",positionId:"",currentPage:1,totalItems:-1,perPage:10,positionLeaders:[],leaders:"",currEditing:null,triggerEdit:!1,typeEdit:""}},created:function(){this.search()},computed:{totalPages:function(){return Math.ceil(this.totalItems/this.perPage)}},watch:{},methods:{search:function(){var t=this;this.appLoading=!0;var e={leader_id:this.leaders,department_id:this.departmentId,position_id:this.positionId,page:this.currentPage,limit:this.perPage};a(e).then(function(e){e.data.success?(t.positionLeaders=e.data.data,t.totalItems=e.data.total,0===t.totalItems&&(t.positionLeaders=[])):(t.totalItems=0,t.positionLeaders=[])}).catch(function(t){console.log(t)}).then(function(){t.appLoading=!1}),this.firstTime=!1},handleSelectedDepartment:function(t){this.departmentId=t?t.id:""},handleSelectedPosition:function(t){this.positionId=t?t.id:""},deletePositionLeader:function(t){var e=this;if(confirm("Bạn có chắc chắn muốn xóa config cho vị trí ("+t.position_name+") thuộc phòng ban ("+t.department+") không ?")){var i={id:t.id};this.$startLoading(),s(i).then(function(t){t.data.success?(e.$notify({group:"default",type:"bg-success text-white",title:"Thông báo",text:"Xóa bản ghi thành công!"}),e.search()):e.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo",text:t.data.message})}).catch(function(t){console.log(t),e.$notify({group:"default",type:"bg-warning text-dark",title:"Thông báo",text:"Có lỗi xảy ra trong quá trình xóa bản ghi."})}).then(function(){e.appLoading=!1,e.$stopLoading()})}},handleLeaderSelected:function(t){this.leaders=t?t.map(function(t){return t.id}).toString():""},openEditModal:function(t,e){this.currEditing=e,this.triggerEdit=!this.triggerEdit,this.typeEdit=t},updatePositionLeader:function(t){t?(E.a.showMessage("Cập nhật thông tin leader thành công","success"),this.search()):E.a.showMessage("Có lỗi xảy ra trong quá trình cập nhật thông tin leader","fail")}}};var D=function(t){i("Y6t8")},$=Object(g.a)(k,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"ui-block"},[i("div",{staticClass:"mb-3"},[i("b-row",[i("b-col",{attrs:{md:"6"}},[i("h4",{staticClass:"ui-block-heading"},[t._v("Quản lý leader bộ phận, vị trí")])]),t._v(" "),i("b-col",{staticClass:"text-right",attrs:{md:"6"}},[i("b-btn",{attrs:{variant:"success"},on:{click:function(e){return t.openEditModal("create",null)}}},[i("i",{staticClass:"ion ion-md-add"}),t._v(" Thêm mới config leader")])],1)],1)],1),t._v(" "),i("div",{staticClass:"mb-3"},[i("b-row",[i("b-col",{attrs:{md:"3"}},[i("single-select-department",{attrs:{"position-id":t.positionId},on:{handleSelectedDepartment:t.handleSelectedDepartment}},[t._v(">")])],1),t._v(" "),i("b-col",{attrs:{md:"3"}},[i("single-select-position",{attrs:{"department-id":t.departmentId},on:{handleSelectedPosition:t.handleSelectedPosition}})],1),t._v(" "),i("b-col",{attrs:{md:"4"}},[i("select-position-leader",{attrs:{"display-all":!0,"leader-ids":t.leaders,"limit-prop":99999,"auto-close":!1,"hide-selected":!0},on:{handleLeaderSelected:t.handleLeaderSelected}})],1),t._v(" "),i("b-col",{staticClass:"text-right",attrs:{md:"2"}},[i("b-btn",{attrs:{type:"button",variant:"primary"},on:{click:function(e){t.currentPage=1,t.search()}}},[i("i",{staticClass:"sidenav-icon ion ion-md-search"}),t._v(" Tìm kiếm")])],1)],1)],1),t._v(" "),i("div",{staticClass:"mb-3"},[i("div",[i("b-card",{attrs:{"no-body":""}},[i("table",{staticClass:"table mb-0 table-hover table-bordered"},[i("thead",[i("tr",[i("th",[t._v("STT")]),t._v(" "),i("th",{staticStyle:{width:"30%"}},[t._v("Bộ phận")]),t._v(" "),i("th",{staticStyle:{width:"30%"}},[t._v("Vị trí")]),t._v(" "),i("th",[t._v("Leader")]),t._v(" "),i("th",[t._v("Action")])])]),t._v(" "),i("tbody",t._l(t.positionLeaders,function(e,n){return i("tr",{key:n},[i("td",[t._v(t._s((t.currentPage-1)*t.perPage+n+1))]),t._v(" "),i("td",[t._v("\n                  "+t._s(e.department)+"\n                ")]),t._v(" "),i("td",[t._v("\n                  "+t._s(e.position_name)+"\n                ")]),t._v(" "),i("td",[e.leaders.length>0?i("div",t._l(e.leaders,function(e){return i("div",[0!=e.master_profile_id?i("router-link",{attrs:{to:{name:"edit-master-profile",params:{id:e.master_profile_id}}}},[i("b-badge",{attrs:{variant:"primary"}},[t._v(t._s(e.fullname)+" ( "+t._s(e.username)+" )")])],1):0!=e.main_profile_id?i("router-link",{attrs:{to:{name:"edit-user",params:{id:e.main_profile_id}}}},[i("b-badge",{attrs:{variant:"primary"}},[t._v(t._s(e.fullname)+" ( "+t._s(e.username)+" )")])],1):i("b-badge",{attrs:{variant:"primary"}},[i("p",[t._v(t._s(e.fullname)+" ( "+t._s(e.username)+" )")])])],1)}),0):t._e()]),t._v(" "),i("td",{},[i("div",{staticStyle:{margin:"auto",width:"fit-content"}},[i("b-btn",{staticClass:"btn btn-outline-secondary",on:{click:function(i){return t.openEditModal("edit",e.id)}}},[i("i",{staticClass:"ion ion-md-create"})]),t._v(" "),i("b-btn",{staticClass:"btn btn-md btn-outline-danger",on:{click:function(i){return t.deletePositionLeader(e)}}},[i("i",{staticClass:"ion ion-md-trash"})])],1)])])}),0)]),t._v(" "),i("modal-edit-position-leader",{attrs:{currEditing:t.currEditing,trigger:t.triggerEdit,type:t.typeEdit},on:{"on-updated":t.updatePositionLeader}}),t._v(" "),0===t.totalItems?i("b-card",{staticClass:"text-center"},[t._v("Không có bản ghi phù hợp")]):t._e(),t._v(" "),t.totalPages>0?i("div",{staticClass:"mt-3"},[i("b-row",[i("b-col",[i("b-pagination",{attrs:{"total-rows":t.totalItems,"per-page":t.perPage,align:"center"},on:{input:t.search},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1):t._e()],1)],1)])])])},[],!1,D,"data-v-3b77df38",null);e.default=$.exports},Y6t8:function(t,e){},lK0I:function(t,e){}});