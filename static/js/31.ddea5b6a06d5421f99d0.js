webpackJsonp([31],{Cyym:function(e,t){},"Lc5+":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("RUzx"),i=s.n(a),n=s("hC/b"),r=s("UL8A"),l=s("TpM6"),o=s("TyzE"),c=s("3BrW"),m={name:"manager-cskh-b2c",components:{Multiselect:i.a,AssignMember:r.a,commonHelper:n.a,MultiSelectProvince:o.a,MultiSelectStation:c.a,CustomerCareService:l.a},data:function(){return{isLeader:!1,triggerShow:!1,paginConfig:{per_page:5,current_page:1,total_row:0},filter:null,customerCareMember:[],customerCares:[],teams:null,fields:[{key:"id",label:"ID",sortable:!0,thStyle:"width: 3%"},{key:"name",label:"Tên team",sortable:!0,thStyle:"width: 15%"},{key:"leader_name",label:"Tên leader",sortable:!0,thStyle:"width: 15%"},{key:"team_member",label:"Thành viên team",sortable:!0,thStyle:"width: 23%"},{key:"provinces",label:"Tỉnh",sortable:!0,thStyle:"width: 17%"},{key:"stations",label:"Kho",sortable:!0,thStyle:"width: 20%"},{key:"actions",label:"Chỉnh sửa",thStyle:"width: 7%"}],propObj:null,isBusy:!1}},created:function(){this.isLeaderTeam(),this.getCustomterCares()},mounted:function(){},watch:{},computed:{},methods:{isLeaderTeam:function(){var e=this;l.a.isLeaderB2C().then(function(t){t.data.success?e.isLeader=t.data.success:n.a.showMessage(t.data.message,"warning")})},triggerShowModal:function(){this.triggerShow=!this.triggerShow},createTeam:function(){this.propObj=null,this.triggerShowModal()},getCustomterCares:function(){var e=this;l.a.getCustomerCares().then(function(t){t.data.success?(e.customerCares=t.data.data,e.getCusotmerCareB2CTeams()):n.a.showMessage(t.data.message,"warning")})},onFiltered:function(e){this.paginConfig.total_row=e.length,this.paginConfig.current_page=1},customRecord:function(e){var t=e.ErpUser,s=e.ErpStation,a=e.ErpAddress;return t.fullname+" ("+t.username+" - "+s.name+" - "+a.name+")"},customCellToSearchMember:function(e){return this.convertMember(e).map(function(e){return e.ErpUser.fullname+" - "+e.ErpUser.username+" - "+e.ErpStation.name+" - "+e.ErpAddress.name})},handleProvinceSelected:function(e){this.provinceIds=e?e.map(function(e){return e.id}).toString():""},handleStationSelected:function(e){this.stationIds=e?e.map(function(e){return e.id}).toString():""},getCusotmerCareB2CTeams:function(){var e=this;l.a.getCustomerCareTeams({type:1}).then(function(t){t.data.success?(e.isBusy=!0,e.teams=t.data.data,e.teams.forEach(function(t){t.member_id=e.convertMember(t.member_id)}),e.paginConfig.total_row=e.teams.length,e.$refs.dataTable.refresh(),n.a.showMessage(t.data.message,"success")):(e.isBusy=!0,n.a.showMessage(t.data.message,"warning"))})},convertMember:function(e){return e.length>0&&this.customerCares.length>0?this.customerCares.filter(function(t){return e.includes(t.ErpUser.id)}):[]},editTeam:function(e){this.propObj=e,this.triggerShowModal()},deleteCustomerCareTeam:function(e){var t=this;this.$bvModal.msgBoxConfirm("Bạn có chắc chắn muốn xóa team "+e.name+" không ?",{title:"Xin hãy xác nhận:",size:"sm",buttonSize:"sm",okVariant:"danger",okTitle:"Xác nhận",cancelTitle:"Hủy bỏ",footerClass:"p-2",hideHeaderClose:!1,noCloseOnBackdrop:!0,centered:!0}).then(function(s){if(s){var a=[];e.member_id.length>0&&(a=e.member_id.map(function(e){return e.ErpUser.id}));var i={team_id:e.id,leader_id:e.leader_id,member_ids:a};l.a.deleteTeam(i).then(function(e){e.data.success?(n.a.showMessage(e.data.message,"success"),t.getCusotmerCareB2CTeams()):n.a.showMessage(e.data.message,"warning")})}}).catch(function(e){console.log(e)})}}},d=s("XyMi");var u=function(e){s("OEkN"),s("UXEM")},h=Object(d.a)(m,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-card",{attrs:{"no-body":""}},[s("b-card-body",[s("h3",[e._v("Danh sách team CSKH B2C:")]),e._v(" "),s("hr"),e._v(" "),s("b-row",[s("b-col",[s("b-form-input",{staticClass:"search-size",attrs:{size:"sm",placeholder:"Tìm kiếm ..."},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})],1),e._v(" "),s("b-col",{staticClass:"text-right"},[s("b-button",{staticClass:"pt-1 pb-1",attrs:{disabled:!e.isLeader,variant:"outline-primary"},on:{click:e.createTeam}},[s("i",{staticClass:"ion ion-md-add"}),e._v(" Tạo Team")])],1)],1),e._v(" "),s("assign-member",{attrs:{"trigger-show":e.triggerShow,"all-users":e.customerCares,type:1,propObj:e.propObj},on:{success:e.getCusotmerCareB2CTeams}}),e._v(" "),s("br"),e._v(" "),s("div",{staticClass:"table-responsive"},[s("b-table",{ref:"dataTable",staticClass:"card-table",staticStyle:{"text-align":"center"},attrs:{id:"data-shop-city",items:e.teams,fields:e.fields,striped:!1,bordered:!0,outlined:!0,hover:!0,"per-page":e.paginConfig.per_page,"current-page":e.paginConfig.current_page,filter:e.filter},on:{filtered:e.onFiltered},scopedSlots:e._u([{key:"cell(leader_name)",fn:function(t){return[s("a",{staticClass:"blue",attrs:{href:"https://admin.giaohangtietkiem.vn/admin/users/detail/"+t.item.leader_id,target:"_blank"}},[e._v(e._s(t.item.leader_name))])]}},{key:"cell(team_member)",fn:function(t){return[s("div",{staticClass:"text-right text-show"},[0!=t.item.member_id.length?s("span",[s("b",[e._v(e._s(t.item.member_id.length))]),e._v(" thành viên")]):e._e()]),e._v(" "),s("div",{staticClass:"non-blur custom-multiselect"},[s("multiselect",{staticClass:"multiselect-primary",attrs:{options:e.customerCares,placeholder:"Không có thành viên",selectedLabel:"Đã chọn",deselectLabel:"Bỏ chọn",selectLabel:"Chọn","track-by":"ErpUser",label:"ErpUser",disabled:!0,searchable:!0,multiple:!0,"hide-selected":!0,"allow-empty":!0,"custom-label":e.customRecord},model:{value:t.item.member_id,callback:function(s){e.$set(t.item,"member_id",s)},expression:"row.item.member_id"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Rất tiếc, không tìm thấy!")])])],1)]}},{key:"cell(actions)",fn:function(t){return[s("div",{staticClass:"pl-3"},[s("b-button",{staticClass:"pt-1 mb-2 pb-1 w-button",attrs:{disabled:!e.isLeader,variant:"outline-info"},on:{click:function(s){return e.editTeam(t.item)}}},[s("i",{staticClass:"ion ion-md-create"}),e._v(" Chỉnh sửa")]),e._v(" "),s("b-button",{staticClass:"pt-1 pb-1 w-button",attrs:{disabled:!e.isLeader,variant:"outline-danger"},on:{click:function(s){return e.deleteCustomerCareTeam(t.item)}}},[s("i",{staticClass:"ion ion-md-trash"}),e._v(" Xóa team")])],1)]}},{key:"cell(provinces)",fn:function(t){return[s("div",{staticClass:"text-right text-show"},[null!=t.item.province_id?s("span",[s("b",[e._v(e._s(t.item.province_id.split(",").length))]),e._v(" tỉnh")]):e._e()]),e._v(" "),s("multi-select-province",{class:"non-blur custom-multiselect",attrs:{isDisabled:!0,"display-all":!0,"province-ids":t.item.province_id,"limit-prop":99999,"auto-close":!1,"hide-selected":!0},on:{handleProvinceSelected:e.handleProvinceSelected}})]}},{key:"cell(stations)",fn:function(t){return[s("div",{staticClass:"text-right text-show"},[null!=t.item.station_id?s("span",[s("b",[e._v(e._s(t.item.station_id.split(",").length))]),e._v(" kho")]):e._e()]),e._v(" "),s("multi-select-station",{class:"non-blur custom-multiselect",attrs:{limitProp:200,provinceIds:t.item.province_id,"station-ids":t.item.station_id,isDisabled:!0,"auto-close":!1,"hide-selected":!0},on:{handleStationSelected:e.handleStationSelected}})]}}])}),e._v(" "),e.isBusy?e._e():s("div",{staticClass:"sk-folding-cube sk-primary"},[s("div",{staticClass:"sk-cube1 sk-cube"}),e._v(" "),s("div",{staticClass:"sk-cube2 sk-cube"}),e._v(" "),s("div",{staticClass:"sk-cube4 sk-cube"}),e._v(" "),s("div",{staticClass:"sk-cube3 sk-cube"})])],1),e._v(" "),e.paginConfig.total_row>0?s("b-pagination",{staticClass:"mt-2",attrs:{"total-rows":e.paginConfig.total_row,"per-page":e.paginConfig.per_page,align:"center",size:"sm"},model:{value:e.paginConfig.current_page,callback:function(t){e.$set(e.paginConfig,"current_page",t)},expression:"paginConfig.current_page"}}):e._e()],1)],1)},[],!1,u,"data-v-48a62f00",null);t.default=h.exports},UL8A:function(e,t,s){"use strict";var a=s("c/Tr"),i=s.n(a),n=s("woOf"),r=s.n(n),l=s("RUzx"),o=s.n(l),c=s("hC/b"),m=s("TpM6"),d=s("TyzE"),u=s("3BrW"),h=s("HveU"),p={name:"assign-member",components:{Multiselect:o.a,commonHelper:c.a,CustomerCareService:m.a,MultiSelectProvince:d.a,MultiSelectStation:u.a,SweetModal:h.a},props:["triggerShow","allUsers","propObj","type"],data:function(){return{teamID:null,teamName:null,teamLead:null,provinceIds:null,stationIds:null,members:[],propsObj:{},isBusy:!1}},created:function(){},mounted:function(){},watch:{triggerShow:function(e,t){this.$refs.my_modal.show();var s=this.propsObj=r()({},this.propObj);this.assignValue(s)},propObj:function(e,t){e&&(this.propsObj=r()({},e))},propsObj:function(e,t){e&&this.assignValue(e)}},computed:{},methods:{assignValue:function(e){this.teamID=e.id,this.teamName=e.name,this.teamLead=this.convertMember(e.leader_id)[0],this.provinceIds=e.province_id,this.stationIds=e.station_id,void 0!==e.member_id&&(this.members=e.member_id)},customRecord:function(e){var t=e.ErpUser,s=e.ErpStation,a=e.ErpAddress;return t.fullname+" ("+t.username+" - "+s.name+" - "+a.name+")"},handleProvinceSelected:function(e){this.provinceIds=e?e.map(function(e){return e.id}).toString():""},handleStationSelected:function(e){this.stationIds=e?e.map(function(e){return e.id}).toString():""},close:function(){this.clearData(),this.propsObj=null},ok:function(e){var t=this;if(this.isBusy=!0,null==this.teamName)c.a.showMessage("Hãy nhập tên team!","warning"),e.preventDefault();else if(null==this.teamLead)c.a.showMessage("Hãy chọn Leader!","warning"),e.preventDefault();else{var s=null;this.members.length>0&&(s=this.members.map(function(e){return e.ErpUser.id}));var a={team_id:this.teamID,leader_id:this.teamLead.ErpUser.id,team_name:this.teamName,type:this.type,province_id:this.provinceIds,station_id:this.stationIds,member_id:s};[1,2,3].includes(this.type)&&(e.preventDefault(),m.a.insertCustomerCareTeam(a).then(function(e){e.data.success?(t.isBusy=!1,c.a.showMessage(e.data.message,"success"),t.clearData(),t.propsObj=null,t.$emit("success"),t.$refs.my_modal.hide()):(t.isBusy=!1,c.a.showMessage(e.data.message,"warning"))}))}},cancel:function(){this.clearData(),this.propsObj=null},clearData:function(){this.teamID=null,this.teamName=null,this.teamLead=null,this.provinceIds=null,this.stationIds=null,this.members=[]},convertMember:function(e){return(e=i()(e))&&e.length>0&&this.allUsers.length>0?this.allUsers.filter(function(t){return e.includes(t.ErpUser.id)}):[]}}},b=s("XyMi");var v=function(e){s("OEkN"),s("Cyym")},g=Object(b.a)(p,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-modal",{ref:"my_modal",attrs:{size:"lg",title:"Tạo team CSKH:","no-close-on-backdrop":"","cancel-title":"Hủy bỏ",static:""},on:{ok:e.ok,cancel:e.cancel,close:e.close}},[s("b-row",[s("b-col",{attrs:{md:"2"}},[s("h5",{staticClass:"mt-2"},[e._v("Tên team: "),s("span",{staticClass:"red"},[e._v("(*)")])])]),e._v(" "),s("b-col",[s("b-form-input",{attrs:{placeholder:"Nhập tên team"},model:{value:e.teamName,callback:function(t){e.teamName=t},expression:"teamName"}})],1)],1),e._v(" "),s("br"),e._v(" "),s("b-row",[s("b-col",{attrs:{md:"2"}},[s("h5",{staticClass:"mt-2"},[e._v("Leader: "),s("span",{staticClass:"red"},[e._v("(*)")])])]),e._v(" "),s("b-col",[s("multiselect",{staticClass:"multiselect-primary",attrs:{options:e.allUsers,placeholder:"Chọn Leader",selectedLabel:"Đã chọn",deselectLabel:"Bỏ chọn",selectLabel:"Chọn","track-by":"ErpUser",label:"ErpUser",searchable:!0,multiple:!1,"hide-selected":!0,"allow-empty":!1,"custom-label":e.customRecord},model:{value:e.teamLead,callback:function(t){e.teamLead=t},expression:"teamLead"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Rất tiếc, không tìm thấy!")])])],1)],1),e._v(" "),s("br"),e._v(" "),s("b-row",[s("b-col",{attrs:{md:"2"}},[s("h5",{staticClass:"mt-2"},[e._v("Chọn tỉnh:")])]),e._v(" "),s("b-col",[s("multi-select-province",{attrs:{"display-all":!0,"province-ids":e.provinceIds,"limit-prop":99999,"auto-close":!1,"hide-selected":!0},on:{handleProvinceSelected:e.handleProvinceSelected}})],1)],1),e._v(" "),s("br"),e._v(" "),s("b-row",[s("b-col",{attrs:{md:"2"}},[s("h5",{staticClass:"mt-2"},[e._v("Chọn kho:")])]),e._v(" "),s("b-col",[s("multi-select-station",{attrs:{"limit-prop":200,provinceIds:e.provinceIds,"station-ids":e.stationIds,"auto-close":!1,"hide-selected":!0},on:{handleStationSelected:e.handleStationSelected}})],1)],1),e._v(" "),s("br"),e._v(" "),s("div",{staticClass:"mt-2"},[s("b-row",[s("b-col",[s("h5",[e._v("Chọn thành viên:")])]),e._v(" "),s("b-col",{staticClass:"text-right"},[e._v(e._s(e.members.length)+" thành viên")])],1),e._v(" "),s("multiselect",{staticClass:"multiselect-primary",attrs:{options:e.allUsers,placeholder:"Chọn thành viên",selectedLabel:"Đã chọn",deselectLabel:"Bỏ chọn",selectLabel:"Chọn","track-by":"ErpUser",label:"ErpUser",searchable:!0,multiple:!0,"hide-selected":!0,"allow-empty":!0,"custom-label":e.customRecord},model:{value:e.members,callback:function(t){e.members=t},expression:"members"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Rất tiếc, không tìm thấy!")])])],1),e._v(" "),e.isBusy?s("div",{staticClass:"sk-folding-cube sk-primary"},[s("div",{staticClass:"sk-cube1 sk-cube"}),e._v(" "),s("div",{staticClass:"sk-cube2 sk-cube"}),e._v(" "),s("div",{staticClass:"sk-cube4 sk-cube"}),e._v(" "),s("div",{staticClass:"sk-cube3 sk-cube"})]):e._e()],1)},[],!1,v,"data-v-df1af9b4",null);t.a=g.exports},UXEM:function(e,t){}});