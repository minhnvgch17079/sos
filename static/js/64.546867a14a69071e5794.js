webpackJsonp([64],{"+nk/":function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=t("RUzx"),s=t.n(l),o=t("QKlT"),n=t.n(o),r=t("vxzc"),i=t("Bo22"),_=t.n(i),m=t("PJh5"),p=t.n(m),h=t("hC/b"),c={name:"show-sale-salary",components:{Multiselect:s.a,flatPickr:n.a,VueMonthlyPicker:_.a,Moment:p.a,commonHelper:h.a},data:function(){return{sale:null,fullname:null,minMonth:new p.a("2019-10"),salaryMonth:(new p.a).format("YYYY-MM"),showCollapseSalary:!1,showCollapseDetailKpi:!1,totalSalary:0,salaryDetail:{prob_guaranteed_salary:0,prob_ds_salary_m1:0,prob_ds_salary_m2:0,prob_holiday_salary:0,prob_leave_without_salary:0,emp_guaranteed_salary:0,emp_ds_salary_m1:0,emp_ds_salary_m2:0,emp_holiday_salary:0,emp_leave_without_salary:0,leave_salary:0,allowance_manager:0},kpiEmployee:{total_shop:0,total_pkgs:0,total_revenue:0,emp_ds_m1:0,emp_ds_m2:0,prob_ds_m1:0,prob_ds_m2:0,manager_level:null},timeSheet:{total_work_date:0,require_work_date:0,holiday:0,leave:{has_salary:0,without_salary:0}},salaryRangeTime:null,config:{mode:"range",altInput:!0,altFormat:"Y-m-d",dateFormat:"Y-m-d",minDate:"2019-09-21",theme:"light"},paginConfig:{per_page:10,current_page:1,total_row:0},filter:null,totalShop:0,totalPackages:0,totalRevenue:0,dataShopDetail:[],fields:[{key:"shop_code",label:"Mã shop",sortable:!0},{key:"shop_name",label:"Tên shop",sortable:!0},{key:"shop_created",label:"Thời gian tạo",sortable:!0},{key:"first_time_success",label:"Thời gian lấy thành công",sortable:!0},{key:"pkgs_1",label:"Số đơn hàng thành T1",sortable:!0},{key:"revenue_1",label:"Doanh số tháng 1",sortable:!0},{key:"pkgs_2",label:"Số đơn hàng thành T2",sortable:!0},{key:"revenue_2",label:"Doanh số tháng 2",sortable:!0}],isBusyRangeTime:!0,isBusyMonth:!0}},created:function(){this.getUserInfo()},mounted:function(){},watch:{salaryRangeTime:function(a,e){var t=(a+"").split(" to ");t.length>1&&(this.dataShopDetail=[],this.getShopDetail(t[0],t[1]))},salaryMonth:function(a,e){this.calSalarySale(),this.getSalaryRangeTimeByMonth()}},computed:{},methods:{getUserInfo:function(){var a=this;r.a.getCurrentUserInfo().then(function(e){e.data.success?(a.sale=e.data.data,a.fullname=a.sale.ErpUser.fullname,a.salaryMonth=new p.a(e.data.times.to),h.a.showMessage(e.data.message,"success")):h.a.showMessage(e.data.message,"warning")}).catch(function(a){console.log(a)})},calSalarySale:function(){var a=this,e=this.salaryMonth.format("YYYY-MM").toString().split("-"),t={user_id:this.sale.ErpUser.id,month:e[1],year:e[0]};r.a.calSaleSalaryByMonth(t).then(function(e){e.data.success?(a.totalSalary=e.data.total_salary,a.salaryDetail=e.data.salary_detail,a.kpiEmployee=e.data.detail.kpi_employee,a.timeSheet=e.data.detail.time_sheet,h.a.showMessage(e.data.message,"success")):h.a.showMessage(e.data.message,"warning")}).catch(function(a){console.log(a)})},getShopDetail:function(a,e){var t=this,l={from:a,to:e};r.a.getShopDetailInRangeTime(l).then(function(a){a.data.success?(t.dataShopDetail=a.data.data,t.paginConfig.total_row=a.data.total_shops,t.totalShop=a.data.total_shops,t.totalPackages=a.data.total_packages,t.totalRevenue=a.data.total_revenue,h.a.showMessage(a.data.message,"success")):h.a.showMessage(a.data.message,"warning")})},checkTypeRangeTime:function(){(this.salaryRangeTime+"").split(" to ").length<1&&h.a.showMessage("Sai định dạng thời gian!","warning")},onFiltered:function(a){this.paginConfig.total_row=a.length,this.paginConfig.current_page=1},getSalaryRangeTimeByMonth:function(){var a=this,e=this.salaryMonth.format("YYYY-MM").split("-"),t={year:e[0],month:e[1]};r.a.getSalryRangeTime(t).then(function(e){if(e.data.success){var t=new p.a,l=t=t.subtract(1,"days"),s=new p.a(e.data.times.end_date);t>s&&(l=s),a.salaryRangeTime=e.data.times.start_date+" to "+l.format("YYYY-MM-DD")}else h.a.showMessage(e.data.message,"warning")})}}},d=t("XyMi");var g=function(a){t("OEkN"),t("0csG")},u=Object(d.a)(c,function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",[t("b-card",{attrs:{"no-body":""}},[t("b-card-body",[t("b-row",[t("b-col",{attrs:{cols:"5"}},[t("b-row",[t("h4",{staticClass:"mt-1 ml-2"},[a._v("Tổng quan kỳ lương:  ")]),a._v(" "),t("vue-monthly-picker",{staticClass:"monthly-picker",attrs:{alignment:"center",dateFormat:"MM-YYYY",min:a.minMonth,clearOption:!1},model:{value:a.salaryMonth,callback:function(e){a.salaryMonth=e},expression:"salaryMonth"}})],1)],1),a._v(" "),t("b-col",{staticClass:"mt-1",attrs:{cols:"6"}},[t("h4",[a._v(a._s(a.fullname))])]),a._v(" "),t("b-col",{attrs:{cols:"1"}},[t("a",{attrs:{href:"https://admin.giaohangtietkiem.vn/admin/co_che_luong/sale.html",target:"_blank"}},[a._v("Xem cơ chế lương")])])],1),a._v(" "),t("hr"),a._v(" "),t("b-row",[t("b-col",{staticClass:"mt-1"},[t("h5",[t("b-button",{attrs:{size:"sm",variant:"outline-dark"},on:{click:function(e){a.showCollapseSalary=!a.showCollapseSalary}}},[a.showCollapseSalary?t("i",{staticClass:"ion ion-ios-arrow-down"}):t("i",{staticClass:"ion ion-ios-arrow-forward"})]),a._v("\n             Lương dự kiến:  \n            "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.totalSalary))}})],1)])],1),a._v(" "),t("b-collapse",{attrs:{id:"collapse-1"},model:{value:a.showCollapseSalary,callback:function(e){a.showCollapseSalary=e},expression:"showCollapseSalary"}},[t("b-row",[t("b-col",[t("ul",[t("li",[a._v("Lương doanh số tháng 1:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.salaryDetail.prob_ds_salary_m1+a.salaryDetail.emp_ds_salary_m1))}})]),a._v(" "),t("li",[a._v("Lương doanh số tháng 2:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.salaryDetail.prob_ds_salary_m2+a.salaryDetail.emp_ds_salary_m2))}})]),a._v(" "),t("li",[a._v("Công chuẩn:   "+a._s(a.timeSheet.total_work_date)+"/"+a._s(a.timeSheet.require_work_date))])])]),a._v(" "),t("b-col",[t("ul",[t("li",[a._v("Lương lễ:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.salaryDetail.prob_holiday_salary+a.salaryDetail.emp_holiday_salary))}})]),a._v(" "),t("li",[a._v("Lương phép:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.salaryDetail.leave_salary))}})]),a._v(" "),t("li",[a._v("Công phép:   "+a._s(a.timeSheet.leave.has_salary))])])]),a._v(" "),t("b-col",[t("ul",[t("li",[a._v("Phụ cấp quản lý:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.salaryDetail.allowance_manager))}})]),a._v(" "),t("li",[a._v("Trừ tiền nghỉ không lương:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.salaryDetail.prob_leave_without_salary+a.salaryDetail.emp_leave_without_salary))}})]),a._v(" "),t("li",[a._v("Số ngày nghỉ không lương:   "+a._s(a.timeSheet.leave.without_salary))])])])],1)],1),a._v(" "),t("b-row",[t("b-col",[t("h5",[t("b-button",{attrs:{size:"sm",variant:"outline-dark"},on:{click:function(e){a.showCollapseDetailKpi=!a.showCollapseDetailKpi}}},[a.showCollapseDetailKpi?t("i",{staticClass:"ion ion-ios-arrow-down"}):t("i",{staticClass:"ion ion-ios-arrow-forward"})]),a._v("\n             Kpi chi tiết:\n          ")],1)])],1),a._v(" "),t("b-collapse",{attrs:{id:"collapse-2"},model:{value:a.showCollapseDetailKpi,callback:function(e){a.showCollapseDetailKpi=e},expression:"showCollapseDetailKpi"}},[t("b-row",[t("b-col",[t("ul",[t("li",[a._v("Số shop:   "+a._s(a.kpiEmployee.total_shop))]),a._v(" "),t("li",[a._v("Tổng doanh số:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.kpiEmployee.prob_ds_m1+a.kpiEmployee.emp_ds_m1+a.kpiEmployee.prob_ds_m2+a.kpiEmployee.emp_ds_m2))}})])])]),a._v(" "),t("b-col",[t("ul",[t("li",[a._v("Tổng số đơn:   "+a._s(a.kpiEmployee.total_pkgs))]),a._v(" "),t("li",[a._v("Doanh số tháng 1:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.kpiEmployee.prob_ds_m1+a.kpiEmployee.emp_ds_m1))}})])])]),a._v(" "),t("b-col",[t("ul",[t("li",[a._v("Cấp bậc quản lý:   "+a._s(a.kpiEmployee.manager_level))]),a._v(" "),t("li",[a._v("Doanh số tháng 2:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.kpiEmployee.prob_ds_m2+a.kpiEmployee.emp_ds_m2))}})])])])],1)],1),a._v(" "),t("b-row",[t("b-col",[t("b-row",{staticClass:"ml-1"},[t("h5",{staticClass:"mt-2"},[a._v("Chi tiết shop:  ")]),a._v(" "),t("flat-pickr",{staticClass:"w-200px h-30px bg-white mr-2",attrs:{config:a.config,placeholder:"Chọn khoảng thời gian",name:"date",events:["onClose"]},on:{"on-close":function(e){return a.checkTypeRangeTime()}},model:{value:a.salaryRangeTime,callback:function(e){a.salaryRangeTime=e},expression:"salaryRangeTime"}})],1)],1)],1),a._v(" "),t("b-row",{staticClass:"mt-1"},[t("b-col",[t("ul",[t("li",[a._v("Tổng số shop:   "+a._s(a.totalShop))])])]),a._v(" "),t("b-col",[t("ul",[t("li",[a._v("Tổng số đơn:   "+a._s(a.totalPackages))])])]),a._v(" "),t("b-col",[t("ul",[t("li",[a._v("Tổng doanh số:   "),t("span",{directives:[{name:"numeral",rawName:"v-numeral"}],domProps:{textContent:a._s(Math.floor(a.totalRevenue))}})])])]),a._v(" "),t("b-col",[t("b-form-input",{attrs:{size:"sm",placeholder:"Tìm kiếm ..."},model:{value:a.filter,callback:function(e){a.filter=e},expression:"filter"}})],1)],1),a._v(" "),t("b-table",{ref:"dataTable",staticClass:"card-table",staticStyle:{"text-align":"center"},attrs:{id:"data-shop",items:a.dataShopDetail,fields:a.fields,striped:!1,bordered:!0,outlined:!0,hover:!0,"per-page":a.paginConfig.per_page,"current-page":a.paginConfig.current_page,responsive:"",filter:a.filter},on:{filtered:a.onFiltered}}),a._v(" "),a.paginConfig.total_row>0?t("b-pagination",{staticClass:"mt-2",attrs:{"total-rows":a.paginConfig.total_row,"per-page":a.paginConfig.per_page,align:"center",size:"sm"},model:{value:a.paginConfig.current_page,callback:function(e){a.$set(a.paginConfig,"current_page",e)},expression:"paginConfig.current_page"}}):a._e()],1)],1)],1)},[],!1,g,"data-v-5d9449fa",null);e.default=u.exports},"0csG":function(a,e){}});